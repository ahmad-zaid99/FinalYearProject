{"id": "S001048251400167X", "article": "MAIN-TITLE Real-time electrocardiogram P-QRS-T detection\u2013delineation algorithm based on quality-supported analysis of characteristic templates   HIGHLIGHTS          A low-latency and accurate algorithm for real-time detection of the ECG P-QRS-T waves.      Response time about 8-ms for detection of the QRS complexes.      Response time about 198-ms and 177-ms for detection of P- and T-waves, respectively.      Relative high operating characteristics for real-time detection of P-, QRS-, and T-waves.      Evolving correction of generated clusters for increasing the final accuracy of the algorithm.          KEYPHRASES   Electrocardiogram  Real-time QRS complex detection  Real-time P-wave detection\u2013delineation  Real-time T-wave detection\u2013delineation  P-wave template  T-wave template  Correlation analysis  Waveform clustering   The electrocardiogram (ECG) is a simple and non-invasive test for recording the electrical activity of the heart. This signal has three main waves called P, QRS and T, which represent atrial depolarization, ventricular depolarization, and ventricular repolarization, respectively. These waves have significant characteristic features such as occurrence time, amplitude, intervals, and waveform, and several arrhythmias can be diagnosed on the basis of these features. In any application, in which the instantaneous status of the cardiac system must be monitored, one of the important approaches is to record and analyze the ECG signal in real-time mode. For instance, in the ICU, patients with the risk of cardiogenic shock, hypotensive episodes, sudden cardiac arrest, and deep unconsciousness during anesthesia must be continuously monitored by evaluating RR-interval variations, T-wave alternans, P-wave variability, QT interval, and ST-segment elevation level. As another example, in heart rehabilitation systems such as enhanced external counter pulsation, the pneumatic control system receives direct feedback from instantaneous locations of R- and P-waves of the patient, which should be provided by a precise real-time ECG analysis algorithm. On the other hand, in implantable devices such as pacemakers and defibrillators, intercardiac ECG signals should be analyzed in real-time with an algorithm of high accuracy with detection of events conducted with low delay. Therefore, providing a fast and accurate algorithm is helpful for extracting ECG signal features and characteristic events. Until now, various methods have been introduced for the real-time detection of the QRS complex, such as methods based on non-linear transform [1], pattern recognition [2], digital filters and Hilbert transform [3\u201311], wavelet transform [12\u201314], QRS complex slope estimation [15], adaptive filters [16], and curve length concept [17]. Furthermore, several proposed methods for the real-time detection of P- and T-waves are established on the basis of P- and T-wave slopes [18], Bayesian inference [19], wavelet transform [20], template matching [21], and threshold-based methods [22].  In several methods of the aforementioned researches, two important parameters of real-time analysis algorithms, i.e., \u201caccuracy\u201d and \u201calgorithm response time\u201d, are not considered simultaneously during the design procedure. In other words, reporting only the accuracy of a real-time ECG analysis algorithm is not sufficient and its response time should be considered during design of the method.  In addition, operating characteristics of an algorithm are strongly dependent on the quality of the processed signal. This means that the quality level of the analyzed signal should be reported for which the accuracy of the method is evaluated. So far, this problem is considered in a few previous studies [23,24].  The main goal of this study is to present a new method to improve the response time without loss of accuracy during noisy conditions. In the proposed method, real-time detection of the QRS complex is conducted by applying signal first-order derivative and adaptive threshold adjustment. According to information theories, decision-making based on multiple criteria significantly reduces the false detection of the QRS complex. Moreover, algorithm response time is enhanced desirably with the replacement of high-delay digital filters by efficient low-latency preprocessing algorithms. Correlation analysis conducted between characteristic templates (P- and T-wave templates) and the ECG signal is applied for the online detection of ECG non-impulsive waves. Besides, the algorithm tests signal quality online, which in low-quality cases can estimate the locations of P- and T-waves on the basis of the previously detected locations of characteristic events. The performance of the proposed method is evaluated by its application to the MIT-BIH arrhythmia database (MITDB) [25], QT database(QTDB) [26,27], and Physionet/CinC challenge 2011 competition database [28]. For evaluation of the performance of the proposed method against reduction of signal quality, the algorithm is tested on the open-source artificially generated ECG signal [29,30], whose quality is adjustable according to the random-walk noise theory.  In this study, for performance evaluation of the proposed algorithm, four ECG databases are used. These databases are (1) the MIT-BIH Arrhythmia Database [25] (48 30-min and two-channel recordings with sampling frequency of 360Hz), (2) QT Database [26,27] (105 15-min two-channel recordings with sampling frequency of 250Hz), (3) Physionet/CinC Challenge 2011 [28] (which includes 1500 10-s annotated standard 12-lead ECG recordings with sampling frequency of 500Hz) and (4) the artificially generated ECG signal [23,29,30] (which includes arbitrary number of quality-variable beats with a tunable sampling frequency). In the third database, the training set is called set \u201ca\u201d (1000 12-lead signals) and the test set is called set \u201cb\u201d (500 12-lead signals). All 1000\u00d712=12,000 signals of the training set (set \u201ca\u201d) are put in a new set called \u201cc\u201d).  The general block diagram of the proposed method is presented in Fig. 1.  The proposed method has four major steps:  For every new sample, the last signal window of a specific length is preprocessed by discrete wavelet transform (DWT).In this process, the powerline interference, high frequency noise, and baseline wander are filtered.  With every new sample, three features are extracted on the basis of the signal and its first-order derivative. Next, QRS complexes are detected by devising appropriate decision rules in which required thresholds are tuned adaptively.  After gathering data for 60s, the training phase begins. This phase includes offline analysis procedures. First, all P- and T-waves are detected. Then, all waveforms are clustered and the characteristic templates are generated by implementing ensemble averaging of members in each cluster [31\u201333].  This phase includes online analysis procedures. With every new sample, first, the quality of the last signal window of a specific length is tested. If the quality level is acceptable, then P- and T-waves are delineated by correlation analysis conducted between the signal and their templates. On the other hand, if the quality of the analysis is window is unacceptable, the locations of the P- and T-waves are estimated on the basis of the locations of previously detected P- and T- waves, respectively. It must be noted that the training phase is continued parallel to the test phase so as to generate the ability of self-tuning when new waveforms appear in the signal. In other words, the templates are updated by detecting all new P- and T-waves and if the correlation between the signal and the templates is lower than a specific threshold, a new cluster is generated.  DWT is applied for real-time preprocessing of the signal. This transformation has many advantages such as applicability for analysis of non-linear and non-stationary signals such as ECG, acceptable performance even in short-time frames, and low information destruction of the original signal. Daubechies 4 (db. 4) is chosen as the type of the mother wavelet. The original signal is decomposed into 8 levels. First- and second-level detail coefficients and last level approximate coefficients are set to zero to remove high frequency noise and baseline wander effects, respectively. The remaining detail coefficients are filtered on the basis of the threshold value introduced by Donoho and Johnstone [34] and soft thresholding function. The denoising procedure is used in an analysis window of approximately 700-ms length. For implementation of the aforementioned denoising, by registering every new sample, a window of approximately 700-ms length, whose end sample is the latest output of the acquisition system, is filtered and reconstructed. The last sample of the reconstruction process is saved as the equivalent filtered value of the last acquisition sample. It should be noticed that this procedure is repeated for every new sample acquisition. However, the samples of the moving window are chosen from the originally acquired samples. In other words, each sample is filtered only once and its filtered value is pushed back to the filtered array.  The proposed QRS detection algorithm has two main stages including preprocessing and decision rules discussed in the following. All window lengths are determined experimentally so as to achieve the best possible accuracy and lowest latency for the designed structure.  In the preprocessing stage, three features are extracted from the signal and its first-order derivative. Different methods exist for the calculation of the first-order derivative. The simplest one is the conventional first-order differentiation operator, which causes extreme noise amplification. To prevent noise amplification, the method presented in [31] has been implemented for calculating the first-order derivative of the signal. Because of the averaging process proposed in [31], the noise effect is sufficiently reduced. The first-order derivative is calculated according to Eq. (1):  (1)  d ( i ) =  1 L   \u2211  k = 1  L   tan (   \u03b8   ik   )   where   \u03b8   ik   represents the angle between the line, which connects the i and k samples, and the horizontal line, and L is the window length. The window length is considered to be approximately 27-ms.  The features are calculated as follows:  The first feature is the signal arc length. With every new sample, in the last window of 27-ms length, the signal arc length is determined according to the method presented in [35]. This length is considered as approximately half of the average duration of a QRS complex (normal duration of a QRS complex is 0.06\u20130.1s [36]). As a consequence, a local peak value is generated in the ALC curve when every R-wave occurs ( Fig. 2).  The second feature is area under the first-derivative curve. With every new sample, according to the method proposed in [35], the area under the first-derivative curve is computed in the last window of 13-ms length. The length of this window is approximately a quarter of the duration of a QRS complex for preventing large delays. Up to this stage, the total delay is composed of the delay caused by the determination of first-order derivative and the delay of the area under curve calculation.  Then, this value is compared with a specific threshold level according to Eq. (2).  (2)    ASC   \u03c4   ( i ) =  {      ASC ( i )      ASC ( i ) \u2265   \u03c4   A   \u00d7   A   QRS        0     ASC ( i ) <   \u03c4   A   \u00d7   A   QRS           where ASC(i) is the ASC amplitude at the last registered sample and   ASC   \u03c4   ( i ) is its filtered value. Furthermore, A QRS is the ASC amplitude at the location of the QRS complex estimated according to the first 5s of the signal (in this duration, at least one QRS complex will definitely occur).      \u03c4   A   is the ASC threshold that is equal to 0.7, and the selection procedure of this threshold will be discussed in Section 3.1.This feature provides information about the energy variations of the QRS complexes (Fig. 2).  The third feature is the mean of the signal first-order derivative in a window of 55-ms length. For MSC calculation, the behavior of the obtained curve will be smoother for a longer window length. Because the locations of Q-and S-waves are detected on the basis of MSC, it should be relatively smoother than other feature signals. Thus, a longer window length is preferred for the extraction of the MSC feature.  This quantity provides information about each QRS complex width.  In Fig. 2, the three feature signals at the location of two QRS complexes are shown.  Then, these features are used in the structure of decision rules in order to detect QRS complexes.  To detect R-waves, two conditions are assessed. If these two conditions are met, a new R-wave is detected. The required conditions are as follows:  \u2022 A local maximum occurs in ASC (Fig. 2).  The three feature values calculated on the basis of ALC, ASC, and MSC exceed the following adaptive thresholds at the location of the ASC local maximum (Fig. 2).  (3)  {      ALC (   i  \u204e  ) \u2265   \u03b1   1   \u00d7   ALC   m         ASC (   i  \u204e  ) \u2265   \u03b1   2   \u00d7   ASC   m         MSC (   i  \u204e  ) \u2265   \u03b1   3   \u00d7   MSC   m          where ALC  (   i  \u204e  ) , ASC (   i  \u204e  ) , and MSC (   i  \u204e  ) are ALC, ASC, and MSC amplitudes at the location of the occurred ASC local maximum, and ALCm, ASCm, and MSCm are the averages of ALC, ASC, and MSC quantities at the location of detected R-waves, respectively. (These values are updated with every new R-wave detection.) Moreover,   \u03b1   1   ,   \u03b1   2   ,  and    \u03b1   3   are regulating factors updated by every new QRS complex detection.  The regulating factor for each feature is updated on the basis of the ratio between the detected R-wave feature value to the average of the previous R-wave feature value. Namely, first, the following ratios are computed for features ALC, ASC, and MSC:  (4)  {        \u03b2   1   =     \u03b1   1   \u00d7   ALC   m       ALC   R             \u03b2   2   =     \u03b1   2   \u00d7   ASC   m       ASC   R             \u03b2   3   =     \u03b1   3   \u00d7   MSC   m       MSC   R            where ALCR, ASCR, and MSCR are amplitudes of the three feature signals at the location of the new detected R-wave.  Second, by substituting the value of   \u03b2   i   into the next experimentally obtained function, the regulating factors (   \u03b1   i   s ) are determined as follows:  (5)    \u03b1   i   = \u2212 0.5   \u03b2   i   3   + 0.15   \u03b2   i   2   \u2212 0.015   \u03b2   i   + 0.7005 ,  i = 1 , 2 , 3      The curve of regulating factors   \u03b1   i   versus the   \u03b2   i   value is depicted in Fig. 3.  As represented in Fig. 3, the curve has three main portions:   Part I. In this part,   \u03b2   i   , for i=1,2,3, has a small value. It indicates that the thresholdlevel is considerably lower than the feature signal amplitude. Consequently, high frequency noise and P- and T-waves might be falsely detected as R-wave. Therefore, the regulating factor   \u03b1   i   , for i=1,2,3, causes increment of the associated threshold level (Eq. (3)) relative to its previous value (Eq. (3)).   Part II. In this part, the thresholds are optimum. In other words, they are large enough to prevent the false detection of noise as R-wave. Meanwhile, they are small enough to detect low-energy R-waves. Therefore, the threshold level will not change significantly in this region.   Part III. In this part,   \u03b2   i   , for i=1,2,3, has a large value. It means that the threshold level is around the amplitudes of the feature signal because of which low-energy QRS complexes might not be recognized. Therefore, the regulating factor (   \u03b1   i   , for i=1,2,3) causes decrement of the associated threshold level (Eq. (3)) relative to its previous level.  Q-wave detection is independent of R detection. To detect this wave, the following conditions are checked for every new sample:  (6)  {      ALC ( i ) \u2265   \u03b1   1   \u00d7   ALC   m         ASC ( i ) \u2265   \u03b1   2   \u00d7   ASC   m         MSC ( i ) \u2265   \u03b1   3   \u00d7   MSC   m          where ALC(i), ASC(i), and MSC(i) are the ALC, ASC, and MSC amplitudes of the last registered sample. If these three conditions are satisfied simultaneously, the last MSC local extremum before the i-th sample is marked as Q-wave ( Fig. 4).  After the detection of a new R-peak, the first local extremum of MSC is S-wave with the condition that the detected local extremum must have a maximum (/minimum) amplitude in a 40-ms interval (Fig. 4).  For the generation of P- and T-wave templates, a training phase begins after 60s of data gathering. In this phase, P- and T-waves are delineated in offline mode, and then their waveforms are clustered. Finally, a template is extracted for each cluster by the application of the ensemble averaging technique to its members.  Offline detection of P- and T-waves is accomplished by the method presented in [24]. In the presented method, a pattern recognition algorithm is designed for distinguishing various ECG clusters, which occur between consecutive R- waves. Then, the templates of dominant events of each cluster waveform are extracted. Finally, by the application of correlation analysis, P-and T-waves are delineated (more details are presented in [24]).  The criterion for clustering P- and T-waveforms is based on correlation analysis between the obtained waves. Namely, if x is a cluster core sequence,  x \u02dc  is a test wave sequence, and  x \u02dc  is the sequence of difference between them (  x \u02dc  = x \u2212  x \u02dc  ) , then the correlation coefficient between the two waves is computed as follows (proposed in [28]):  (7)  C =  Max  1  (  1 \u2212   \u222b     x \u02dc   2   d t    \u222b  (   x  2  \u2212 mean   ( x )  2  )  d t    , 0  )    The clustering procedure of P- and T-waves is performed as follows. The first detected wave itself is the core of the first cluster. Then, the correlation between the next wave and the first cluster core is determined according to Eq. (7). If the correlation coefficient is greater than a specific threshold, then the test wave is added to this cluster. Otherwise, the test wave itself creates a new cluster. For other waves, this process is repeated.  For the generation of a template for each cluster, the first member is considered as C T ( Fig. 5-a). Then, the following process is repeated separately for all members of the cluster:  1- The cross-correlation between the i-th member (W  i ) and C T is determined as follows (Fig. 5-a):  (8)  \u03b3 ( \u03c4 ) =   E [ (   C   T   t   \u2212   \u03bc     C   T     ) (   W   i   t + \u03c4   \u2212   \u03bc     W   i     ) ]     \u03c3     C   T       \u03c3     W   i         where   \u03c3     C   T      and    \u03bc     C   T     ,  and    \u03c3     W   i      and     \u03bc     W   i     represent the mean value and standard deviation of CT and Wi, respectively, and \u03c4 is the time lag (Fig. 5-b).   W  i and C T are aligned at the time lag \u03c4 (\u03c4 is denoted in Eq. (8)) where they have maximum correlation (Fig. 5-c), and then, their average is calculated as follows (Fig. 5-d):  (9)    C   L   =     C   T   \u00d7 n +   W   i     n + 1     where n is the number of members incorporated into template extraction until this stage.  The value of C T is updated by C L.  Finally, when this process was repeated for all members, the final C L is the generated cluster template.  Sometimes, the analysis of the ECG signal is accompanied by significant errors generated either by the chaotic behavior of the heart system (such as arrhythmias, mechanical anomalies, and fibrillations) or by noise potentials, artifacts, and external disturbances. In these situations, chaotic/low-quality segments are generated in the ECG trend; their quality is not sufficient for the application of any analysis algorithm. Hence, even utilization of denoising techniques for the recovery of signal information does not help, and usually, the algorithm recognizes the locations of P- and T-waves falsely. Some examples of different chaotic/low-quality segments that occur in the ECG signals are shown in Fig. 6.  In such situations, a better option is to guess the locations of P- and T-waves by resorting to previously detected waves. As a result, devising an efficient criterion for the identification of chaotic/low-quality segments is necessary.  Two criteria are employed to distinguish between low- and high-quality parts of the signal. The first one is the number of local extremums, and the second is the arc length in a window of a specific length.  \u2022  Local extremums   With every new sample, in the last window of 2s length, the number of local extremums (N mL) is computed[31].   Arc length   With every new sample, arc length (ALL) is calculated according to the method proposed in [35] in the last window of 2s length.  Now, according to Eq. (10), if the number of local extremums and arc length of the analysis window are within the specified range of thresholds, the analysis window has an acceptable quality. On the other hand, if at least one of them is not within the associated admissible range, the quality of the window is unacceptable and the locations of P- and T-waves will be guessed in this window. The mentioned thresholds are determined by histogram analysis, which will be discussed in Section 3.1.  (10)  Window  quality =  {           \u03c4   min   N   \u2264   N   mL   ( i ) \u2264   \u03c4   max   N       &       \u03c4   min   AL   \u2264   AL   L   ( i ) \u2264   \u03c4   max   AL          Acceptable            N   mL   ( i ) >   \u03c4   max   N    or     N   mL   ( i ) <   \u03c4   min   N       or       AL   L   ( i ) >   \u03c4   max   AL    or     AL   L   ( i ) <   \u03c4   min   AL          Unacceptable         where   \u03c4   max   N   and   \u03c4   min   N   are the upper and lower limits of the acceptable number of local extremums, respectively, and   \u03c4   max   AL   and   \u03c4   min   AL   are upper and lower limits of the acceptable arc length, respectively.  After the detection of a new QRS complex, the search for the detection of a new T-wave is started.  With the registration of every new sample, the analysis window is moved one step forward ( Fig. 7). Then, the window quality (Eq. (10)) and the correlation coefficient between the analysis window and all of the obtained T-wave templates are computed (Eq. (7)). According to the obtained values, three different cases can occur.  The window that is more correlated with T-wave templates among others is T-wave. The search for this wave is terminated until beginning of the new cycle. Furthermore, the cluster whose template has the highest correlation with the T-wave templates is the winner cluster. A new member is added to the winner cluster, and the template of this cluster is updated as follows:  (11)    T   UT   =      T   T   \u00d7 n +    T   N     ( n + 1 )     where T N is the new detected T-wave, T T is the winner cluster template, n is the number of members in the cluster, and T UT is the updated cluster template.  In the training phase, the interval between each R-wave and the next T-wave offset is estimated. If a window with a correlation coefficient higher than 0.8 is not observed in the interval following the occurrence of the new R-wave, then a new waveform is considered to have occurred. In this situation, the algorithm estimates the location of T-wave by utilizing the information of previously detected T-waves; the new wave itself constitutes a new cluster.  In this case, the location of T-wave is estimated by utilizing the information of previously detected T-waves. However, this wave cannot constitute a new cluster.  These three probable cases are shown in Fig. 8.  In general, real-time P-wave detection is similar to the T-wave detection process. However, there are two noticeable differences mentioned below:  1- Search for P-wave begins after lapse of 0.6\u00d7RRaverage [36] (RRaverage is the average of previous RR intervals, which is updated after the detection of every new R) from the new R-wave.  Absence of P-wave (this case could occur in different arrhythmias such as atrial fibrillation, sinoatrial block, and junctional rhythm [36]) is also checked by the algorithm.  If there was no window with a correlation coefficient higher than 0.8, the algorithm does not make the decision for the location of P-wave till the beginning of the next cycle. Because the maximum duration of PR interval isapproximately200-ms [36], if there is no local extremum in this duration, P-wave is assumed to be absent in the search interval. Otherwise, a new waveform can be found and a new cluster will be created. Fig. 9 shows all the probable cases in the real-time detection of P-wave.   RESULTS   All the utilized thresholds and window durations are obtained experimentally so as to achieve the best possible results. In the following section, the procedure of their selection is discussed.  In Section 2.4.1, it is expressed that a threshold is considered for ASC. If the amplitude of this curve is less than 0.7\u00d7A QRS (Eq. (2)), then its value will be set to zero. For the determination of this threshold optimum level, its value is altered from 0.1 to 0.9, and during each increment, the accuracy of the QRS detection algorithm is evaluated. The algorithm is implemented to an artificially generated ECG signal expressed in Section 2.1. The quality of this signal is reduced to 0.7 by the random-walk noise theory.  According to Fig. 10, when the threshold value   \u03c4   A   is assigned toapproximately0.7, (   \u03c4   A   = 0.7 ) , the best possible performance can be achieved by the algorithm.  In Section 2.6.1, four thresholds are expressed for the determination of signal quality. For the determination of these thresholds, a window of 2s length is moved on all the signals of set \u201cc\u201d (Section 2.1). In each frame, the number of local extremums (index1) and the arc length (index2) are calculated. In each signal, index1 of the frame, whose number of local extremums is the greatest among all other frames, is selected as the signal first index. Furthermore, index2 of the frame, whose arc length is the greatest among all other frames, is selected as the signal second index. The distributions of these indices are illustrated in two histograms, (  Figs. 11 and 12). As it can be seen in Figs. 11 and 12, the number of extremums and arc length of the most signals lie between specific ranges. Thus, if at least one of the number of extremums or arc length of a signal is located out of the admissible ranges, the signal quality is low and should be categorized as unacceptable. In Section 2.6.1, the associated equations are expressed.  To evaluate the performance of the proposed real-time QRS complex detection method, the algorithm is applied to lead I of all 48 records of MITDB [25] ( Table 1). The results of the Pan and Tompkins method are also presented in this table. The two methods are compared according to their three performance characteristics: sensitivity (Se), positive predictivity (P+), and mean response time (MRT).  Se, P+, and MRT are defined as follows:  (12)      Se =   TP   TP + FN   %       P + =   TP   TP + FP   %       where TP is the number of true-positive detections, FN is the number of false-negative detections, and FP is the number of false-positives detections.  Moreover, MRT can be defined as follows:  (13)  MRT =  1 n   \u2211  i = 1  n   |  Detection    time   i   \u2212 Actual     time   i    |  \u00d7 1000  ms   where i represents the i-th detected event and n is the total number of events.  The proposed method for the QRS complex detection are Se=99.81% and P+=99.70%. These operating characteristics are Se=99.75% and P+=99.53% for the Pan and Tompkins algorithm [10]. Besides, the algorithm MRT for R-wave detection is 8-ms in this study and is 124-ms in the Pan and Tompkins algorithm. The comparison conducted between the proposed method and the methods proposed in some previous studies are presented in Table 2.  In Section 2.4.2, it is expressed that all R-wave-related thresholds are adaptive. The alternation of the ASC threshold (Eq. (3)) in an arbitrary ECG signal is shown in Fig. 13. According to this figure, if a constant threshold is chosen, many of the low-energy QRS complexes are missed falsely.  To assess the proposed signal quality evaluation method, the method is tested on set \u201cb\u201d (test set) of Physionet/CinC Challenge 2011 competition database [28]. The achieved results are presented in Table 3 in terms of accuracy and specificity (Sp) defined as follows:  (14)  Sp =   TN   TN + FP   %      (15)  Accuracy =   TP + TN   TP + TN + FP + FN   %      In addition, the results of this method are compared with those of some of the other quality evaluation methods in Table 4.  For the evaluation of the real-time P-QRS-T detection method, the algorithm is applied to 40 records of QTDB[26,27] ( Table 5).Overall performance of the algorithm in terms of four evaluation parameters is shown in Table 6. The parameter RMSE in this table is calculated according to Eq. (16). This parameter shows the RMS error between the real and predicted locations of the events:  (16)  RMSE =   |     \u2211  i = 1  n    ( Predicted   Event    Time   i   \u2212 Actual  Event     Time   i   )  2   n   |   \u00d7 1000  ms   where i is the i-th detected event and n is the total number of events.  Because of the low amplitude and low energy of P-waves and the similarity of some noisy components to this wave, the accuracy of P-wave detection is lower than that of T-wave detection. Moreover, RMSE is calculated to show the average error between the real and predicted locations of the events. This parameter is 15.55-ms, 6.43-ms, and 10.63-ms for P, R, and T peaks, respectively, indicating more complexity of the detection of P-wave relative to that of other waves.  The algorithm MRT for the detection of P- and T-waves is 198-ms and 177-ms, respectively. Opposite to the detection of QRS complexes, the detection of P- and T-waves can be completed only after the complete occurrence of these waves. Thus, this process causes a considerably more delay in detecting P- and T-waves than in detecting R-waves. However, a compromise exists between algorithm accuracy and MRT in the detection of P- and T-waves. It means that as far as response time increases, the algorithm detects the locations of P- and T-waves with greater reliability. On the other hand, reducing response time causes an increase in the probable false-positive/false-negative errors of the algorithm.    Table 7 shows a comparison between the performance of the presented method with the methods presented in some previous studies.  In this study, the robustness of the proposed method in maintaining the required precision under reduction of signal quality is evaluated. To this end, the algorithm is tested on the artificially generated ECG signal mentioned in Section 2.1. The quality of this signal is altered from the best case (100%) to the worst case (\u226440%) according to the random-walk theory ( Fig. 14). For example, a 40% quality means that the approximate correlation between the original clean ECG and its noisy version is approximately 0.4 (more details are presented in [23]). In each decrement, the algorithm accuracy is evaluated ( Table 8). Low signal quality leads to a lower correlation between the signal and the obtained templates. Therefore, several new clusters will be created and consequently, guessing the locations of P- and T-waves will increase. Hence, the accuracy and reliability of the algorithm will decrease. According to Table 8, when the signal quality is lower than 60%, at least 10% of P- and T-waves detections take place by the guessing process. In this manner, detection accuracy will decline to lower than 70%. The behavior of algorithm accuracy against the quality value of the signal is shown in Fig. 15.   DISCUSSION   In real applications, because the algorithm might face new situations at any time, real-time ECG signal analysis has great difficulties. The proposed method benefits the main feature that it has ability to adapt itself to any new condition. Clustering P- and T-waveforms and generating new clusters under forthcoming conditions significantly increase the accuracy of the algorithm such that the results of the proposed real-time method are quite comparable with those of other offline methods [24,41,42].  Taking advantages of wavelet denoising causes a strong reduction in the noise impact of the signal, which eventuates notable decrement in FP detection in comparison to FN detection during the identification of P-QRS-T waves (Table 5).  QRS complex detection is the basic step for P- and T-wave delineation. Therefore, higher the accuracy and lower the latency of QRS complex detection, greater the speed and accuracy of P-and T-wave delineation. In the proposed QRS detection algorithm, considering short length windows decreases the algorithm response time significantly. In the previously proposed methods such as [10], utilization of digital filters with a large length results in imposition of high delays in the detection of the QRS complex. The response times of the proposed algorithm and the method presented in [10] are approximately 8-ms and 124-ms, respectively. On the other hand, multi-criteria decision rules based on the amplitude and first-order differentiation of the signal increase the accuracy along with a decrease in the detection of the RMS error.   CONCLUSION   In this study, a method is proposed for the real-time detection of P-QRS-T waves of the ECG signal. Real-time QRS complex detection is performed on the basis of the amplitude and first-order derivative of the signal. The obtained results show high accuracy and short response time of the algorithm. The algorithm detects QRS complexes with Se=99.83% and P+=99.98% based on QTDB and Se=81% and P+=70% based on MITDB. Moreover, MRT is approximately 8-ms. P- and T-wave real-time detection is based on correlation analysis conducted between their templates and the signal. Based on QTDB, the proposed method has Se=99.63% and P+=99.83%, and Se=99.74 and P+=99.89 for the detection of P- and T- waves, respectively. As an important merit, the algorithm delays for the detection of P- and T-waves are 198-ms and 177-ms, respectively. In addition, it is shown that the algorithm performance is reliable for signal quality of approximately higher than 70%. High accuracy, short response time, and simplicity are the main features of the proposed procedure.  No conflict of interest.   REFERENCES", "highlights": "The main objective of this study is to introduce a simple, low-latency, and accurate algorithm for real-time detection of P-QRS-T waves in the electrocardiogram (ECG) signal. In the proposed method, real-time signal preprocessing, which includes high frequency noise filtering and baseline wander reduction, is performed by applying discrete wavelet transform (DWT). A method based on signal first-order derivative and adaptive threshold adjustment is employed for real-time detection of the QRS complex. Moreover, detection and delineation of P- and T-waves are achieved by correlation analysis conducted between signal and their templates. Besides, signal quality is investigated online, and if the quality of the analysis window is unacceptable, then the algorithm will guess (estimate) the locations of P- and T-waves. The operating characteristics of the proposed algorithm are evaluated by its implementation to an artificially generated ECG signal whose quality is adjustable from the best (Quality, 100%) to the worst (Quality, \u226440%) cases based on the random-walk noise theory. The algorithm was applied to the MIT-BIH arrhythmia database, QT database, and Physionet/CinC challenge 2011competition database. The obtained results, which were based on the QT database, showed sensitivity and positive predictivity of Se=99.63% and P+=99.83%, Se=99.83% and P+=99.98%, and Se=99.74% and P+=99.89% for the detection of P-, QRS-, and T-waves, respectively, and the obtained results, which were based on the MIT-BIH arrhythmia database, showed Se=99.81% and P+=99.70% for the detection of the QRS complex. Moreover, it will be shown that the results of the proposed method are reliable for a minimum signal quality value of 70%. According to numerical assessments, 8-ms after the occurrence of R-wave, its location will be identified by the computer code of the proposed algorithm. This parameter is 198-ms and 177-ms for P- and T-waves, respectively."}