{"id": "S0168874X16300142", "article": "MAIN-TITLE Multiscale analysis of heat treatments in steels: Theory and practice   HIGHLIGHTS          Description of the differential formulation of the transient multiscale model as well as its numerical equations, practical implementation, validation and multiscale application.      Application of a rigorous and consistent multiscale tool called Asymptotic Expansion Homogenization.      Application of the transient multiscale model to model heat treatments is original. No publication was found with this approach.          KEYPHRASES   Transient multiscale analysis  Asymptotic Expansion Homogenisation  Periodic microstructure  Heat treatments   Steels are widely used on many applications and some of them require heat treating the material in order to achieve the desired strength, machinability or formability [1]. During quenching, hardenable steels may suffer dramatic changes in their microstructure and, consequently, on their properties. Such processes may lead to the appearance of undesirable effects such as residual stresses and distortions on the steel part [2]. The residual stresses have their origin on plasticity phenomena and phase transformations. Moreover, inhomogeneous cooling processes tend to intensify the unwanted effects. Nowadays, there is little doubt that steel phase transformations play a major role in the development of residual stresses and should be taken into account [3]. Therefore, this work presents a transient multiscale model capable of reproducing the thermomechanical behaviour in the referred transformations using the Asymptotic Expansion Homogenisation (AEH) methodology and Finite Element Method (FEM).  Homogenisation is rapidly maturing due to the increasing power of computation. However, this subject dates back to many years ago, starting with homogenisation methods such as effective medium models of Eshelhy [4], Mori and Tanaka [5], self-consistent approaches of Hill [6] and many others [7]. Later, a new mathematical homogenisation methodology emerged as the Asymptotic Expansion Homogenisation pioneered by Bensoussan et al. [8].  Many authors followed this subject, as Sanchez-Palencia [9], Guedes and Kikuchi [10], Hollister and Kikuchi [11], Terada and Kikuchi [12], Chung et al. [13], Yuan and Fish [14], Pinho-da-Cruz et al. [15], Zhang et al. [16], \u00d6zdemir et al. [17], Goupee and Vel [18], and Terada et al. [19]. For instance, Zhang et al. [16] used a thermomechanical multiscale model in order to model the thermodynamic wave propagation phenomena. \u00d6zdemir et al. [17] also used a thermomechnical multiscale with particular emphasis in modelling thermal shocks and consequent thermomechanical damage and debonding. Later, Terada et al. [19] also used a thermomechanical multiscale model with microscale heat transfer in order to analyse porous solids.  The base formulation of the presented multiscale model has been used by other authors in order to model many phenomena, as previously enumerated. However, the modelling of steel heat treatments with phase transformations provides a new application. The presented transient multiscale model is implemented in the commercial Computer-Aided Engineering (CAE) software ABAQUS [20]. This provides engineers and/or new researchers with a methodology to create their own transient multiscale model. This is taken further with a code subroutine that is provided in Appendix A, in order to facilitate and encourage new developments.  The AEH methodology considers the existence of two distinct scales: a micro- and a macroscale. During the process, the macroscale is explicitly analysed using the information gathered on a detailed analysis of the microscale. Being a multiscale procedure, the inverse approach is also done. The detailing of the material behaviour in the microscale with the results from the macroscale is called localisation. This homogenisation methodology allows the analysis of a great number of different microstructures, given the requirement of a periodic Representative Unit Cell (RUC) [21]. The main advantages of this methodology are: (i) allowing the modelling of the mechanical, thermomechanical and transient thermal behaviours of periodic materials with a rigorous and effective homogenisation methodology, (ii) reducing the number of degrees of freedom linked to modelling of the material behaviour, (iii) allowing the proper characterisation of periodic heterogeneous microstructures [15] and (iv) analysing the material anisotropy microstructurally for macroscopic use. However, this methodology has drawbacks. If non-linear phenomena (i.e. phase transformations) are introduced, several of microscales are needed, since each material point of the macroscale might evolve in a particular way. Therefore, techniques to reduce the computational costs are needed. Within this work, a methodology to reduce computational costs is presented and the temperature is a key parameter to achieve it. While this work proposes a new approach, this topic has also been studied by other authors. Temizer and Wriggers [22], proposed the use of the eigenvalues of the macroscopic strain tensor and their orientation as a way to construct a material map and therefore reduce computational costs. Yvonnet et al. [23], also proposed the use of a material database that stores the effective strain energy density functions in the macroscopic right Cauchy\u2013Green strain tensor, combined with a simplified interpolation scheme.  This document starts with the introduction of the transient multiscale model formulation, its assumptions and differential formulation, followed by the analysis and discussion of the finite element formulation of the variational problems and their implementation. Then, a validation test is presented, where AEH methodology is compared to the general FEM methodology. In the end, a multiscale application of AEH in heat treatments and its results, such as the characteristic displacement fields, the homogenised properties, the stress and temperature evolution, and the process of localisation for both mechanical and thermal fields, are presented. Finally, some final remarks are provided.  The Asymptotic Expansion Homogenisation is an homogenisation methodology capable of modelling the behaviour of periodic materials in an uncoupled and quasi-static process. The macroscopic behaviour of a heterogeneous material is derived from the heterogeneity scale that describes the physical process over a Representative Unit-Cell (RUC) [21], i.e., the spatial repetition of the RUC form the heterogeneous material. However, the referred element has to be large enough to represent the material and small enough when compared to the macroscopic volume. The fundamental condition can be expressed as  (1)  \u03f5 =   l   L   \u2aa1 1 ,   where l and L are the characteristic lengths of the RUC and macroscopic body, respectively. In the presence of a periodic heterogeneous medium, the AEH is the most effective methodology [24]. At this point, it is common to assume two distinct scales: x and y for the behaviour of the materials in the macroscale and in the microscale, respectively [7]. Thus, the variables related to the referred fields become functionally dependent on both x and y scales, where  (2)  y = x / \u03f5 .   The referred functional dependence is usually called Y-periodicity. Thereby, the Y-periodicity of the microstructural heterogeneities reflects itself on the fact that the thermal expansion tensor \u03b1 , the elasticity tensor D and the thermal conductivity tensor k are Y-periodic in y. In contrast, the material homogeneity at the macroscale level results from the fact that the tensors do not depend on the macroscale x, resulting in  (3)    \u03b1   ij   =   \u03b1   ij   (  y  ) ,      (4)    D   ijkl   =   D   ijkl   (  y  )  and      (5)    k   ij   =   k   ij   ( y ) .   On the macroscale x, the microscale constituents appear over periods \u03f5 \u22121 times smaller than the characteristic dimension of Y. Replacing Eq. (2) in Eqs. (3)\u2013(5) results in  (6)    \u03b1   ij   \u03f5   =   \u03b1   ij   (  x / \u03f5  ) ,      (7)    D   ijkl   \u03f5   =   D   ijkl   (  x / \u03f5  )  and      (8)    k   ij   \u03f5   =   k   ij   (  x / \u03f5  ) ,   respectively, where the superscript \u03f5 states that \u03b1 , D and k are \u03f5 Y -periodic in the macroscale x.  The formulation presented in the following sections is based on the formulations presented in [13,15,25,26].  Assuming infinitesimal strains and a quasi-static process, the linear thermoelastic problem is given by the following equations:  (9)    \u2202   \u03c3   ij   \u03f5     \u2202   x   j   \u03f5     +   f   i   = 0  in  \u03a9 ,      (10)    \u03b5   ij   \u03f5   =   1   2   (    \u2202   u   i   \u03f5     \u2202   x   j   \u03f5     +   \u2202   u   j   \u03f5     \u2202   x   i   \u03f5      )  in  \u03a9  and      (11)    \u03c3   ij   \u03f5   =   D   ijkl   \u03f5     \u03b5   kl   \u03f5   \u2212   \u03b2   ij   \u03f5   \u0394   T   \u03f5   ,   where  (12)  \u0394   T   \u03f5   =   T   \u03f5   \u2212   T   0    and      (13)    \u03b2   ij   \u03f5   =   D   ijkl   \u03f5     \u03b1   kl   \u03f5   =   \u03b2   ij   (  x / \u03f5  ) .       \u03c3   ij   \u03f5   and   \u03b5   ij   \u03f5   are the components of the Cauchy stress and the strain tensors, respectively. f  i , u  i and T 0 are the loads per unit of volume, displacements and the reference temperature, respectively. The boundary of \u03a9 is defined by the surfaces   \u0393   D   and   \u0393   N   . These are related to the Dirichlet and Neumann boundary conditions  (14)    u   i   \u03f5   =     u   \u00af     i    in    \u0393   D    and      (15)    \u03c3   ij   \u03f5     n   j   =     t   \u00af     i    in    \u0393   N   ,   where   \u0393   D   \u222a   \u0393   N   = \u0393 and   \u0393   D   \u2229   \u0393   N   = \u2205 .     u   \u00af     i   and     t   \u00af     i   are the prescribed values of displacements and forces, respectively. n  j are components of the outward unit vector, orthogonal to surface   \u0393   N   .  Considering the existence of two distinct scales, which connect the material behaviour of the macroscale \u03a9 and the microscale Y, the displacement fields can be approximated by an asymptotic expansion in \u03f5, mathematically given by  (16)    u   i   \u03f5   =   u   i   ( 0 )   (  x , y  ) + \u03f5   u   i   ( 1 )   (  x , y  ) +   \u03f5   2     u   i   ( 2 )   (  x , y  ) + \u22ef ,   where   u   i   ( r )   (  x , y  ) , with r \u2208   N   0   and i \u2208 { 1 , 2 , 3 } , are Y-periodic functions in y, called correctors of order r of the displacement field. Considering that y = x / \u03f5 , the application of the chain differentiation rule results in  (17)    \u2202 \u00b7   \u2202   x   i   \u03f5     =   \u2202 \u00b7   \u2202   x   i     +   1   \u03f5     \u2202 \u00b7   \u2202   y   i     .   Replacing Eq. (17) in (10), the linearised thermoelastic problem formulation is obtained. The displacements fields   u   i   ( 0 )   are the solutions of the homogenised thermoelastic problem, defined as  (18)    \u2202   \u03a3   ij     \u2202   x   j     +   b   i   = 0  in  \u03a9 ,      (19)    u   i   \u03f5   =     u   \u00af     i    in    \u0393   D   ,      (20)    \u03a3   ij     n   j   =     t   \u00af     i    in    \u0393   N    and      (21)    \u03a3   ij   =   D   ijkl   h     \u2202   u   k   ( 0 )     \u2202   x   l     \u2212   \u03b2   ij   h   (    T   ( 0 )   \u2212   T   0    )  in  \u03a9 ,   where \u03a3  ij represents the macrostructural stress field.   D   ijkl   h   and   \u03b2   ij   h   represent the homogenised elastic tensor and thermal moduli tensor, respectively, defined as  (22)    D   ijmn   h   =   1   | Y |     \u222b   Y     D   ijkl   (  y  ) (    I   kl   mn   \u2212   \u2202   \u03c7   k   mn     \u2202   y   l      ) d Y  and      (23)    \u03b2   ij   h   =   1   | Y |     \u222b   Y   (    \u03b2   ij   (  y  ) \u2212   D   ijkl   (  y  )   \u2202   \u03a8   k     \u2202   y   l      ) d Y .       I   kl   mn   =   \u03b4   km     \u03b4   ln   , where \u03b4  ij is the Kronecker\u05f3s delta. \u03c7  k   mn and \u03a8  k represent the components of the mechanical and thermomechanical characteristic displacement tensors, respectively, obtained as a solution of  (24)    \u222b   Y     D   ijkl     \u2202   \u03c7   k   mn     \u2202   y   l       \u2202   v   i     \u2202   y   j     d Y =   \u222b   Y     D   ijmn     \u2202   v   i     \u2202   y   j     d Y ,  \u2200   v   i   \u2208     V   \u02dc     Y    and      (25)    \u222b   Y     D   ijkl     \u2202   \u03a8   k     \u2202   y   l       \u2202   v   i     \u2202   y   j     d Y =   \u222b   Y     \u03b2   ij     \u2202   v   i     \u2202   y   j     d Y ,  \u2200   v   i   \u2208     V   \u02dc     Y   ,   where \u03c7  k   mn and   \u03a8   k   \u2208     V   \u02dc     Y   and     V   \u02dc     Y   is the set of Y-periodic continuous and sufficiently regular functions with an average value of zero in Y. The computation of the average value of a Y-periodic function in Y is written as  (26)  < \u03a6   >   Y   =   1   | Y |     \u222b   Y   \u03a6 ( x , y , t )  d Y .      This formulation is based on the micro- and macroscale, and the validity of this assumption is dependent on the existence of periodic oscillations in the displacement fields. These oscillations should overlap macroscopic fields, where a heterogeneous material is approximated by a homogeneous material. In this sense, the results from the macroscale can be used to estimate stress and strain levels in the microscale. This process is called localisation and can be defined as  (27)    \u03c3   ij   ( 1 )   ( x , y ) =   D   ijkl   (  y  ) (    I   kl   mn   \u2212   \u2202   \u03c7   k   mn     \u2202   y   l      )   \u2202   u   m   ( 0 )     \u2202   x   n     + [    D   ijkl   (  y  )   \u2202   \u03a8   k     \u2202   y   l     \u2212   \u03b2   ij   (  y  )  ] (    T   ( 0 )   \u2212   T   0    )  and      (28)    \u03b5   ij   ( 1 )   ( x , y ) =   1   2   (    \u03b4   ik     \u03b4   jl   +   \u03b4   il     \u03b4   jk    ) [  (    I   kl   mn   \u2212   \u2202   \u03c7   k   mn     \u2202   y   l      )   \u2202   u   m   ( 0 )     \u2202   x   n     +   \u2202   \u03a8   k     \u2202   y   l     (    T   ( 0 )   \u2212   T   0    )  ] .   The previous equations allow to estimate microstructural stress and strain levels for every point in the macroscale x. The homogenised stress fields in the macroscale correspond to average values of the microscale fields.  The thermal transient problem is described by the equilibrium equation and the Fourier\u05f3s law for heat conduction as  (29)    \u2202   q   i   \u03f5       x   ij   \u03f5     +   \u03c1   \u03f5     c   \u03f5       T   \u0307     \u03f5   \u2212 Q = 0  in  \u03a9  and      (30)    q   i   \u03f5   = \u2212   k   ij   \u03f5     \u2202   T   \u03f5       x   j   \u03f5      in  \u03a9 ,   for i , j =1, 2, 3. q  i are the components of the conduction heat fluxes and Q is the rate of heat generation per unit of volume.   T   \u03f5   and     T   \u0307     \u03f5   are the temperature value and time rate, respectively.   \u03c1   \u03f5   is the material density and c  \u03f5 is the specific heat. The boundary of \u03a9 is defined by the surfaces   \u0393   D   ,   \u0393   N   and   \u0393   R   . These are related to the Dirichlet, Neumann and Robin boundary conditions  (31)    T   \u03f5   =   T   \u00af    in    \u0393   D   ,      (32)    q   i   \u03f5     n   i   = \u2212   q   \u00af    in    \u0393   N    and      (33)    q   i   \u03f5     n   i   =   h   c   (   T   \u03f5   \u2212   T   \u221e   )  in    \u0393   R   ,   respectively, where   \u0393   D   \u222a   \u0393   N   \u222a   \u0393   R   = \u0393 and   \u0393   D   \u2229   \u0393   N   =   \u0393   D   \u2229   \u0393   R   =   \u0393   R   \u2229   \u0393   N   = \u2205 .   T   \u00af   and   q   \u00af   are the prescribed temperature and conduction heat flux, respectively. n  i are the components of the outward unit vector, orthogonal to the surfaces   \u0393   N   or   \u0393   R   . h  c and   T   \u221e   are the convection coefficient and the room temperature, respectively. The auxiliary variational problem   T   \u03f5   \u2208   V   \u03a9   0   of Eq. (29) becomes [18]   (34)    \u222b   \u03a9     k   ij   \u03f5     \u2202   T   \u03f5       x   j   \u03f5       \u2202 v     x   i   \u03f5      d \u03a9 +   \u222b   \u03a9     \u03c1   \u03f5     c   \u03f5       T   \u0307     \u03f5   v  d \u03a9 =   \u222b   \u03a9   Qv  d \u03a9 +   \u222b     \u0393   N       q   \u00af   v  d \u0393 \u2212   \u222b     \u0393   R       h   c   (   T   \u03f5   \u2212   T   \u221e   ) v  d \u0393 ,   where   V   \u03a9   0   is a set of functions, continuous, sufficiently regular and zero-valued in   \u0393   D   .  With the existence of two different scales, associated to behaviour levels over the macroscale \u03a9 and microscale Y, the temperature field is approximated using the respective asymptotic expansions in \u03f5 as  (35)    T   \u03f5   ( x , t ) =   T   ( 0 )   ( x , y , t ) + \u03f5   T   ( 1 )   ( x , y , t ) +   \u03f5   2     T   ( 2 )   ( x , y , t ) + \u22ef ,   where   T   ( r )   ( x , y , t ) , with r \u2208   N   0   , are Y-periodic functions in y, classified as the r th order temperature field correctors. Replacing the asymptotic expansions of the temperature fields (Eq. (35)) in the Fourier\u05f3s law of heat conduction (Eq. (30)) and making use of Eq. (17) results  (36)    q   i   \u03f5   =   \u03f5   \u2212 1     q   i   ( 0 )   +   \u03f5   0     q   i   ( 1 )   +   \u03f5   1     q   i   ( 2 )   + \u22ef ,      (37)    q   i   ( 0 )   = \u2212   k   ij   ( y )   \u2202   T   ( 0 )     \u2202   y   j      and      (38)    q   i   ( r )   = \u2212   k   ij   ( y , t ) (    \u2202   T   ( r \u2212 1 )     \u2202   x   j     +   \u2202   T   ( r )     \u2202   y   j      ) ,  r \u2208 N .      Substituting Eq. (36) in the equilibrium Eq. (29) and making use of Eq. (17), it is possible to obtain  (39)    \u03f5   \u2212 2     \u2202   q   i   ( 0 )     \u2202   y   i     +   \u03f5   \u2212 1   (    \u2202   q   i   ( 0 )     \u2202   x   i     +   \u2202   q   i   ( 1 )     \u2202   y   i      ) +   \u03f5   0   (    \u2202   q   i   ( 1 )     \u2202   x   i     +   \u2202   q   i   ( 2 )     \u2202   y   i     +   \u03c1   \u03f5     c   \u03f5       T   \u0307     \u03f5   \u2212 Q  ) +   \u03f5   1   \u22ef = 0 .      Considering the fact that Eq. (39) has to be valid for every \u03f5 \u2192 0 , all terms associated with \u03f5 have to be zero, meaning  (40)    \u03f5   \u2212 2   \u21d2   \u2202   q   i   ( 0 )     \u2202   y   i     = 0 ,      (41)    \u03f5   \u2212 1   \u21d2   \u2202   q   i   ( 0 )     \u2202   x   i     +   \u2202   q   i   ( 1 )     \u2202   y   i     = 0 ,      (42)    \u03f5   0   \u21d2   \u2202   q   i   ( 1 )     \u2202   x   i     +   \u2202   q   i   ( 2 )     \u2202   y   i     +   \u03c1   \u03f5     c   \u03f5       T   \u0307     \u03f5   \u2212 Q = 0  and      (43)    \u03f5   r   \u21d2   \u2202   q   i   ( r + 1 )     \u2202   x   i     +   \u2202   q   i   ( r + 2 )     \u2202   y   i     = 0 ,  r \u2208 N .      Analysing Eqs. (40) and (41), and considering the first order of Eq. (38), which is  (44)    q   i   ( 1 )   = \u2212   k   ij   ( y ) (    \u2202   T   ( 0 )     \u2202   x   j     +   \u2202   T   ( 1 )     \u2202   y   j      ) ,   it is possible to obtain  (45)    T   ( 1 )   ( x , y , t ) = \u2212   \u03a5   i   ( y , t )   \u2202   T   ( 0 )     \u2202   x   i     +     T   \u00af     ( 1 )   ( x , t ) .         T   \u00af     ( 1 )   ( x , t ) is an integration constant in Y domain and   \u03a5   i   are the components of the thermal characteristic displacement tensor. In this sense, replacing Eq. (45) in (44) results in  (46)    q   i   ( 1 )   =     q   ^     i   k     \u2202   T   ( 0 )     \u2202   x   k     ,   where   T   ( 0 )   is independent of the microscale, corresponding to the macroscale temperature of the homogenised material.     q   ^     i   k   are Y-periodic functions given by  (47)      q   ^     i   k   = \u2212   k   ij   ( y ) (    I   j   k   \u2212   \u2202   \u03a5   k     \u2202   y   j      ) ,   where   I   j   k   =   \u03b4   jk   is the Kronecker delta.  In order to compute the thermal characteristic displacement tensor \u03a5 , the following auxiliary variational problem   \u03a5   k   \u2208     V   \u02dc     y   must be solved:  (48)    \u222b   Y     k   ij     \u2202   \u03a5   k       y   j       \u2202 v     y   i     d Y =   \u222b   Y     k   ik     \u2202 v     y   i     d Y ,  \u2200 v \u2208     V   \u02dc     Y   ,   where     V   \u02dc     Y   is a set of Y-periodic continuous and sufficiently regular functions with average value of zero in Y.  Applying the operator of Eq. (26) in Eq. (42), it is possible to demonstrate that the macroscale temperature field corresponds to the solution of the variational problem   T   ( 0 )   \u2208   V   \u03a9   0   given by  (49)    \u222b   \u03a9     k   ij   h     \u2202   T   ( 0 )       x   j       \u2202 v     x   i     d \u03a9 +   \u222b   \u03a9     \u03c1   h     c   h       T   \u0307     ( 0 )   v  d \u03a9 =   \u222b   \u03a9   Qv  d \u03a9 +   \u222b     \u0393   N       q   \u00af   v  d \u0393   where   V   \u03a9   0   is a set of continuous, sufficiently regular functions and zero-valued in   \u0393   D    [18], defined as  (50)    T   ( 0 )   =   T   \u00af    in    \u0393   D    and      (51)    \u039e   i     n   i   = \u2212   q   \u00af    in    \u0393   N   .    \u039e  i are the homogenised heat fluxes from the macroscale. These fluxes are obtained by replacing Eq. (47) in (46) and applying the operator of Eq. (26), resulting  (52)    \u039e   i   =   \u3008    q   i   ( 1 )    \u3009   Y   = \u2212   k   ij   h     \u2202   T   ( 0 )     \u2202     x   j    in  \u03a9 ,   where  (53)    k   ij   h   =   1   | Y |     \u222b   Y   \u2212   k   ij   ( y ) (    I   j   k   \u2212   \u2202   \u03a5   k     \u2202   y   j      )  d Y .       \u03c1   h   is the homogenised density and   c   h   is the homogenised specific heat, respectively defined as  (54)    \u03c1   h   =   1   | Y |     \u222b   Y     \u03c1   \u03f5    d Y  and      (55)    c   h   =   1   | Y |     \u222b   Y     c   \u03f5    d Y .      The existence of micro- and macroscale is also considered in the homogenisation of the transient thermal problem. Thus, the periodic oscillations of the temperature field should overlap the macroscopic one, where the heterogeneous material is approximated by a homogeneous medium. Additionally, the results from the macroscale can be used to estimate the microstructural conduction heat fluxes. This process is called localisation and can be defined by replacing Eq. (47) in (46), resulting  (56)    q   i   ( 1 )   = \u2212   k   ij   ( y ) (    I   j   k   \u2212   \u2202   \u03a5   k     \u2202   y   i      )   \u2202   T   ( 0 )     \u2202   x   k     .      The previous equation allows to estimate the microstructural conduction heat flux for every point in the macroscale x. The homogenised conduction heat fluxes in the macroscale correspond to the average values of the microscale.  The microscale problem can be solved in two main steps [13]. The first is finding the solutions of the variational Eqs. (24), (25) and (48) in order to obtain the correctors \u03c7 , \u03a8 and \u03d2 representing the characteristic displacement field tensors for mechanical, thermomechanical and thermal problems, respectively. The finite element approximations for the referred equations are given by  (57)    \u222b   Y     B   T   DB  d Y \u03c7 =   \u222b   Y     B   T   D  d Y ,      (58)    \u222b   Y     B   T   DB  d Y \u03a8 =   \u222b   Y     B   T   \u03b2  d Y  and      (59)    \u222b   Y       M   \u02dc     T   k   M   \u02dc    d Y \u03d2 =   \u222b   Y       M   \u02dc     T   k  d Y ,   where the superscript e stands for element quantities of the RUC domain [15]. B and M are the derivative matrices of the interpolation functions of displacement and temperature fields, respectively.  The second step is the computation of Eqs. (22), (23), (53), (54) and (55) in order to obtain the homogenised properties   D   h   ,   \u03b2   h   ,   k   h   ,   \u03c1   h   and   c   h   , respectively. The finite element approximations for the referred equations are given by  (60)    D   h   =   \u2211   i = 1     n   elm         V   i   e       V   tot       D   i   e   (  I \u2212   B   i   e     \u03c7   i   e    ) ,      (61)    \u03b2   h   =   \u2211   i = 1     n   elm         V   i   e       V   tot     (    \u03b2   i   e   \u2212   D   i   e     B   i   e     \u03a8   i   e    ) ,      (62)    k   h   =   \u2211   i = 1     n   elm         V   i   e       V   tot       k   i   e   (  I \u2212     M   \u02dc     i   e     \u03d2   i   e    ) ,      (63)    \u03c1   h   =   \u2211   i = 1     n   elm         V   i   e       V   tot       \u03c1   i   e    and      (64)    c   h   =   \u2211   i = 1     n   elm         V   i   e       V   tot       c   i   e   ,   where   n   elm   is the number of elements in the RUC,   V   e   is the element volume and   V   tot   is the total volume of the RUC [25].  The AEH methodology allows to explicitly define the stress, strain and conduction heat flux equations for the microscale using the results from the macroscale. The finite element approximations of Eqs. (28), (27) and (56) are  (65)    \u03f5   ( 1 )   = (  I \u2212   B   e   \u03c7  )   B   E     u   ( 0 )   +   B   e   \u03a8 (    T   ( 0 )   \u2212   T   0    ) ,      (66)    \u03c3   ( 1 )   =   D   e   (  I \u2212   B   e   \u03c7  )   B   E     u   ( 0 )   + (    D   e     B   e   \u03a8 \u2212   \u03b2   e    ) (    T   ( 0 )   \u2212   T   0    )  and      (67)    q   ( 1 )   = \u2212   k   e   (  I \u2212     M   \u02dc     e     \u03d2   e    )     M   \u02dc     E     T   ( 0 )   ,   where the superscript E denotes the macrostructural quantities, T 0 represents the reference temperature and   T   ( 0 )   is the temperature of the homogenised material in the global model [15].   u   ( 0 )   and   T   ( 0 )   are the macrostructural displacements and temperature vectors, respectively.  In order to solve the microscale problem, periodicity boundary conditions must be imposed on the outer surface boundaries of the RUC. For a square cell in   y   1   \u2208 [ 0 ,   y   1   0   ] and   y   2   \u2208 [ 0 ,   y   2   0   ] , these conditions can be defined as  (68)    \u03c7   i   jk   ( 0 ,   y   2   ) =   \u03c7   i   jk   (   y   1   0   ,   y   2   )  and   \u03c7   i   jk   (   y   1   , 0 ) =   \u03c7   i   jk   (   y   1   ,   y   2   0   ) .      In order to prevent rigid body motion, the displacements and rotations of at least one arbitrary point must be fixed [27].  The mechanical, thermomechanical and transient thermal microscale models were implemented using two user-element subroutines UEL in ABAQUS [20]. The subroutines are responsible for computing the homogenisation correctors and consequent properties homogenisation over the RUC domain. For instance, the Thermo Mechanical Model is an Abaqus user-element [20] based on a linear quadrilateral finite element with four nodes and full integration. In order to solve the equations of the microscale thermomechanical problem (Eqs. (57) and (58)), Abaqus needs the referred element. Within the element, a stiffness matrix is computed as well multiple load vectors. 1   1 Each load vector is obtained from the right side of Eqs. (57) and (58), where each column represents a load vector integrating the material property components along each respective direction. Thus, the software is able to solve the finite element problems and the resultant displacement fields are the AEH correctors, that are used in the computation of the homogenised properties. In Appendix A,, a code is provided in order to facilitate and illustrate the referred process. The Transient Multiscale Model is identical to the mechanical problem.  The macroscale model consists in four subroutines: (i) USDFLD, to update material density, (ii) UEXPAN, to define incremental thermal strains, (iii) UMAT, to define material mechanical behaviour and (iv) UMATHT, to define material thermal behaviour. Fig. 1 summarises the whole process, representing the fluxes of information between the subroutines.  If the RUC and the microstructural properties are temperature dependent, and the macroscale suffers an inhomogeneous cooling process, each point of the macroscale needs a different equivalent homogeneous material model. Ideally, the External Manager (see Fig. 1) would call the Micro Transient Thermal Model and the Micro Thermo Mechanic Model for every integration point of the macroscale on every time increment. However, this approach would lead to huge computational costs. In this particular case, the problem can be simplified by the creation of a database, where the characteristic displacements and the equivalent homogeneous models are stored for localisation and macroscopic use, respectively. Thus, the macroscale analysis checks a database and interpolates an approximated material model. This approximation reduces the computational costs and allows the use of a refined discretisations in the macroscale. Otherwise, the Micro Transient Thermal Model and the Micro Thermo Mechanic Model would have to be called for every element of the macroscale on every time increment. The implementation of this reduced model is achieved in two main steps. The first step is the construction of the database, where several homogenized properties are computed for a given temperature. Within the microscale computations of the homogenised properties, a representative microstructure for a referred temperature, as well as the properties of its constituents, is considered. After their computation, they are stored in the database. This procedure is repeated for several temperatures. It should be noted that this step can be performed using parallel processes and that this multiscale model is limited to a given microstructural evolution and a given quenching speed, being the link between scales made by temperature. In fact, the application of the HEA method considering macroscale transient heat conduction results, for a fixed microstructure, in a steady-state uncoupled microscale behaviour. In this analysis, microstructure is temperature dependent, so transient macroscale evolution controls the microstructure morphology at the RUC level, which reflects the associated equilibrium (for each timestep) quasistatic microstructural behaviour.  The second step is solving the macrostructural problem. The properties used in the macroscale are extracted from the database, using an average between initial and final temperatures of macroscale integration points on every time increment. If the referred temperature does not exist in the database, interpolated homogenised properties between the two closest temperatures are used instead. Finally, it should be noted that the properties extraction corresponds to a trial and error solution, where the two unknowns are both the final temperature and the thermal properties. Thus, the link between scales is archived using temperature instead of time. However, the time increment of the macroscale should be small in order to avoid large steps and skipping of homogenised properties, ensuring a smooth variation.  In short, the External Manager coordinates the creation of the database and controls the fluxes of information between the six Abaqus subroutines in the presented implementation (see Fig. 1).  The scope of this section is the AEH validation. In order to accomplish this, the results of two different approaches are presented and compared.  A heterogeneous material, formed by materials A and B, is considered. In this material, the volume fraction of material B (represented with white-grey colour in Fig. 2 (c)) is 25%. Table 1 lists the properties of its constituents, where E is the Young\u05f3s Modulus and \u03bd is the Poison\u05f3s ratio. Additionally, the spatial distribution of its constituents is represented in Fig. 2(c) and consists in the spatial repetition of the RUC (Fig. 2(b)).  In the microscale, each constituent of the heterogeneous material is considered as isotropic and analysed here under plane stress conditions. The thermomechanical behaviour is also assumed to be isotropic.  A simulation of a heating process is considered and analysed with two different approaches: the AEH and a direct approach, where each constituent of the heterogeneous material is spatially modelled within the discretisation, as represented in Fig. 2(c). This last approach corresponds to a typical finite element problem. Thus, both implementations consider an uncoupled problem with implicit time integration in a two-dimensional problem. Boundary conditions of symmetry were applied macroscopically and a linear temperature increasing in the right and upper surfaces of the geometry was considered. The initial and the final temperatures are 0\u00b0C and 500\u00b0C, respectively, with a heating rate of 0.125\u00b0C/s.  The scope of this section is to compare the main results of the two different approaches. They are not fully comparable, since AEH considers that \u03f5 (scale ratio) is very small, much lower than the detailed direct approach. However, even with this difference, this comparison proves to be useful in order to understand the numerical stability and clearly provides results that state the validity of the multiscale modelling. Thus, Figs. 3 and 4  present some results for both approaches at different time instants. The general behaviour is identical, but a more careful analysis reveals some differences, as it can be seen in the temporal evolution represented at Fig. 5 . The reference location for each of the evolution curves is provided within the figure. An adaptive time increment was used, where the thermal increment could not exceed 15\u00b0C. The resultant number of time increments was 34, but its refinement in both simulations resulted in relative errors always inferior to 0.5%, being therefore neglected.  In short, the transient multiscale model appears to give reasonable results when compared with the direct model. Moreover, the computational costs are significantly lower, presenting a computational time reduction of 89%, if the localisation process is carried out in all macroscale elements. This major difference is related to the insufficient CPU memory to solve a FEM problem with 923,521 nodes with three degrees of freedom per node (displacements and temperature), resulting in large computational times. This becomes increasingly prohibitive as the scale ratio decreases, requiring increasing model detail for the direct approach.  Consider a dual phase steel that suffers a heat treatment process. The process is composed by a heating stage, resulting in a perfect austenisation of the material, and a quenching stage. During the quenching stage, the steel microstructure undergoes severe changes. Its evolution is a continuous process that is discretised into a finite number of frames. Some of the used frames are represented in Fig. 6 and the microstructure evolution was obtained using a phase field model 2   2 The phase field model was used to obtain several phase distributions for different temperatures. described in [28]. It was considered that the grey, white and black colours represent the presence of Austenite, Ferrite and Bainite, respectively. The properties of the referred phases are provided in Table 2 under a generic linear form of  (69)  \u03d1 =   \u03b9   1   +   \u03b9   2   T ,  \u2200 \u03d1 \u2208 { E , \u03bd , \u03b1 , k , \u03c1 , c } ,   where T is the material phase temperature. During a quenching process, phase transformations are inevitable. Therefore, the RUC of the material has to change accordingly, meaning that the RUC changes during simulation. Each of the considered frames was discretised into a different RUC. Consequently, the representative unit cell becomes dependent on the macroscale temperature. The RUC discretisation was carried out using the centroid of each element and comparing it with the closest frame of the microstructural evolution.  In the microscale, each steel phase is considered as isotropic for the mechanical (plane stress), thermomechanical and thermal behaviours.  The scope of this section is the simulation of the quenching of a gear (cogwheel). The plasticity phenomena are neglected, since it is out of this work\u05f3s scope and significantly increases the complexity and computational costs. The presented implementation considers an uncoupled problem with implicit time integration in a two-dimensional problem. In order to solve the macroscale problem, boundary conditions were applied and a linear temperature decreasing on the outer surface of the gear was considered. The initial and the final temperatures are 1125\u00b0C and 25\u00b0C, respectively, with a quenching rate of 0.24\u00b0Cs\u22121 and 60 increments of time. Fig. 7 represents the referred problem.   RESULTS   The presented implementation carries out several homogenisation procedures for different macroscale temperatures. Consequently, several characteristic displacement fields are evaluated. As an example, Fig. 8 presents the mechanical, thermomechanical and thermal characteristic displacements for a macroscale temperature of 100\u00b0C. The considered representative unit cell corresponds to the discretisation of the first frame of Fig. 6. The components of the tensor \u03a8 of characteristic displacements, represented at Fig. 8(d), illustrates the inhomogeneous material thermal expansion. This inhomogeneity has its foundations on steel phases properties, due to the existence of different thermal expansion coefficients.  A detailed analysis on the equivalent material models indicates an anisotropic material. However, these models, in this particular case, can be approximated by a tetragonal material. Consequently, the mechanical effective properties can be obtained inverting   D   h   , where the compliance matrix   S   h   assumes the general form of  (70)    S   h   = [       1     E   xx       \u2212     \u03bd   yx       E   yy       0     \u2212     \u03bd   xy       E   xx         1     E   yy       0     0   0     1     G   xy         ] .   Thus,   E   xx   ,   E   yy   ,   \u03bd   xy   ,   \u03bd   yx   and   G   xy   are the effective mechanical values. The thermomechanical effective values are obtained by  (71)    \u03b1   h   =   (    D   h    )   \u2212 1     \u03b2   h   ,   where   \u03b1   h   is the vector of effective thermal expansion coefficients. Moreover,   \u03b1   h   assumes the general form of  (72)    \u03b1   h   =   [   \u03b1   xx      \u03b1   yy    0 ]   T   ,   where   \u03b1   xx   and   \u03b1   yy   are the effective thermal expansion coefficients. In this sense, the thermal conductivity homogenised matrix has the general form of  (73)    k   h   = [       k   xx     0     0     k   yy       ] ,   where   k   xx   and   k   yy   are the homogenised thermal conductivity coefficients. For example,   E   xx   and   E   yy   are presented in Fig. 9 showing that the differences between the moduli are less than 0.1%. Therefore, the remaining properties \u03bd, \u03b1 and k are presented for one direction only.   Fig. 9 presents all the effective properties on the reference elements. The effective mechanical properties present a clear trend, while the effective thermal properties tend to follow a less clear evolution. One of the reasons for this fact is related to the properties of the steel phases. The relative differences between the mechanical properties are lower than the relative differences between the thermal properties (see Table 2). However, in all of the effective properties it is possible to identify a hyperbolic trend.  The residual stress at the end of the quenching is non-zero, despite no plastic effects being considered. Its origin is in the inhomogeneous phase transformations allied with an inhomogeneous cooling process. These facts lead to a spatial dependence of the macroscale material properties. Consequently, the residual stress evolution is directly dependent on the inhomogeneous cooling process, because the surface of the steel part cools more rapidly than the inner material, resulting in an earlier contraction of the surface material. This fact leads to a traction state in the peripheral material and a compression state in the inner material. The relation inverts when the peripheral material reaches the ambient temperature as illustrated in Fig. 10 . Moreover, the stiffness of the surface material increases more rapidly than the inner material (see Fig. 9), resulting in a higher stress state.  The presented multiscale model allows to carry out a detailing process in order to characterise microstructural fields. Fig. 11 (a) represents the residual stress both at the macro- and microscales. While the macroscale values characterise the overall residual stress fields on the steel part, the microscale values characterise the residual stress fields on the steel phases, becoming a major advantage of the presented implementation. The macrostructural values of residual stress indicate a clear need of a tempering process in order to decrease the high residual stress state.   Fig. 11(b) shows the heat fluxes both at macro- and microscales for a thermal gradient of 15\u00b0C and a macroscale temperature of 25\u00b0C. The microstructural heat fluxes appear to have some discontinuities. However, the microstructure evolution of the steel has some retained Austenite that has a higher thermal resistance. As a consequence, microstructural conduction heat fluxes flow around the referred points, causing the referred discontinuities. Fig. 12 shows the conduction heat flux vector field that illustrates this concept.   CONCLUSIONS   In the current work, a transient multiscale model which takes into account the phase transformations of steel is presented and the macrostructural response can be predicted without losing the proper characterisation of the steel microstructure or requiring a large number of degrees of freedom. This fact results from the AEH capabilities to model the mechanical, thermomechanic and thermal behaviours of periodic materials. The present implementation is carried out using a commercial computer-aided engineering software, ABAQUS, through specific subroutines. Furthermore, an External Manager was developed to control the process.  The transient multiscale model can simulate complex processes, such as a quenching. Moreover, this work shows that phase transformations can also be modelled and assumes a great importance to properly model heat treatments. In fact, it has a relevant impact on the residual stress fields of the steel part when allied to an inhomogeneous cooling process.   ACKNOWLEDGEMENTS   This work was co-financed by the Portuguese Foundation for Science and Technology via project PTDC/EME-TME/122287/2010 and by FEDER via the Programa Operacional Factores de Competitividade of QREN with COMPETE reference: FCOMP-01-0124-FEDER-020517.  In this appendix, the authors provide the code of an ABAQUS user-element subroutine (uel) for computing the correctors and homogenised thermomechanical properties. This code implements a linear quadrilateral finite element for the characteristic displacements computation and properties homogenisation.   Code 1: Fortran code to illustrate the computation of thermomechanical characteristic displacements fields                                                                   REFERENCES", "highlights": "Multiphase steels offer impressive mechanical properties. However, their characterisation still represents a challenge. In a quenching process, phenomena such as undesirable strains or residual stresses are inevitable and can be the cause for non-admissible final parts. Microstructural phase transformations generally magnify the problem. The non-existence of efficient non-destructive experimental procedures capable of measuring them leads to the need of numerical tools capable of quantifying these undesirable effects. In this work, a numerical multiscale transient model, that uses the Asymptotic Expansion Homogenisation (AEH) methodology combined with Finite Element Method (FEM), is proposed for the analysis of heat treatments in steels. The implementation of the AEH method is carried out using the commercial program Abaqus, considering an uncoupled and transient problem with implicit time integration. Within the homogenisation method, the existence of two distinct scales is assumed, defining a micro- and a macroscale. In the smaller scale, the evolution of a steel periodic microstructure is analysed in detail and an equivalent homogeneous material model is established for macroscopic use. Moreover, it is presented in this work that AEH is a rigorous and effective homogenisation method that allows the modelling of the thermomechanical and transient thermal behaviour in periodic materials, particularly in heat treatments."}