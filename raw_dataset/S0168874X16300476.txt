@&#MAIN-TITLE@&#Co-rotational finite element formulation used in the Koiter–Newton method for nonlinear buckling analyses

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           We present the Koiter–Newton method for nonlinear buckling with large deformations.


                        
                        
                           
                           High order derivatives of the strain energy are facilitated by a co-rotational form.


                        
                        
                           
                           Existing linear element libraries are updated efficiently for nonlinear kinematics.


                        
                        
                           
                           Accurate finite rotations of shells are obtained from three configurations.


                        
                        
                           
                           Accuracy and computational efficiency is demonstrated with several examples.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Koiter–Newton

Geometrically nonlinear structures

Co-rotational formulation

High order derivatives

Nonlinear rotation matrix

@&#ABSTRACT@&#


                  The Koiter–Newton approach is a novel reduced order modeling technique for buckling analysis of geometrically nonlinear structures. The load carrying capability of the structure is achieved by tracing the entire equilibrium path in a stepwise manner. At each step a reduced order model generated from Koiter׳s asymptotic expansion provides a nonlinear prediction for the full model, corrected by a few Newton steps. The construction of the reduced order model requires derivatives of the strain energy with respect to the degrees of freedom up to the fourth order, which is two orders more than traditionally needed for a Newton based nonlinear finite element technique. In this paper we adopt the co-rotational formulation to facilitate these complex differentiations. We extend existing co-rotational beam and shell element formulations to make them applicable for the high order derivatives of the strain energy. The geometrical nonlinearities are taken into account using derivatives of the local co-rotational frame with respect to global degrees of freedom. This is done outside the standard element routines and is thus independent of the element type. We utilize three configurations and the nonlinear rotation matrix to describe finite rotations of the shell accurately, and profit from the automatic differentiation technique to optimize the programming of high order derivatives. The performance of the proposed approach using the co-rotational formulation is demonstrated using benchmark examples of isotropic and laminated composite structures.
               

number of degrees of freedom in the full finite element model

number of degrees of freedom in the reduced order model

number of closely spaced buckling modes

external load, internal load and residual force

displacements in current and nominal configurations

relative displacement from nominal configuration to current configuration

load parameters at current and nominal configurations

increment of load parameter from nominal to current configurations

linear, quadratic and cubic forms in expansion of equilibrium equations

2D, 3D and 4D tensors of 
                           L
                        , 
                           Q
                        , 
                           C
                        
                     

load matrix, load amplitude and sub-loads

generalized displacement and first to third order displacement fields

linear, quadratic and cubic forms in reduced order model

2D, 3D and 4D tensors of 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                        
                     

tangent stiffness matrix


                        α-th unit vector

column vectors of tensors 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                        , components of tensor 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                        
                     

linear displacement of the structure under the external load 
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                        
                     

node number

global coordinate system

co-rotational frame in reference configuration

co-rotational frame in nominal configurations

global and local degrees of freedom

components in global degrees of freedom 
                           q
                        
                     

components in local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        
                     

initial and current length of beam

angle between nominal configuration and x-axis

angle between reference configuration and x-axis

angle between reference and nominal configurations

position vectors of nodes a and b in reference configuration

position vectors of nodes a and b in nominal configuration

curvature, area of cross section and strain energy

global and local internal loads, linear stiffness

coordinates of nodes a and b in initial configuration

node number

global coordinate system

axes in 
                           
                              
                                 T
                              
                              
                                 g
                              
                           
                        
                     

co-rotational frames in reference and nominal configurations

axes in 
                           
                              
                                 T
                              
                              
                                 0
                              
                           
                        
                     

axes in 
                           T
                        
                     

deformation gradient, rotation matrix, tension matrix

displacement from reference to current configurations

relative displacement from reference to nominal configurations

relative displacement from nominal to current configurations

translation part of each node in 
                           q
                        
                     

rotation parts of each node in 
                           q
                        , 
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                         and 
                           u
                        
                     

anti-symmetric matrices formed by three components in 
                           
                              
                                 θ
                              
                              
                                 a
                              
                              
                                 n
                              
                           
                         and 
                           
                              
                                 ϑ
                              
                              
                                 a
                              
                           
                        
                     

local degrees of freedom

translation and rotation parts of each node in 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        
                     

anti-symmetric matrix formed by three components in 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                        
                     

position vector of each node in reference configuration

3×3 identity matrix

rotation matrix of each node

local rotation matrix of each node

local strain and material matrix

@&#INTRODUCTION@&#

The analysis of geometrically nonlinear responses of structures is important for determining their load carrying capability, especially in the case of buckling where a limit point or a bifurcation point exists [1–8]. Utilizing the expanding computational power of modern computers nonlinear finite element analysis (FEA) has become the standard technique used to obtain the nonlinear response of complex structures, however, the repeated analyses that are needed for FEA in the design loop are still computationally demanding. Thus, reduced order techniques that can be used to reduce a problem׳s size significantly are attractive.

Koiter reduction methods [9–17] use the Koiter׳s famous perturbation technique [18] to reduce the number of degrees of freedom in the finite element model. The main advantage of Koiter׳s theory [2,18–20] is the capability to predict quickly but accurate enough the propensity of a structure to buckle and to provide the structure׳s initial postbuckling behavior. In Koiter׳s perturbation technique, his asymptotic expansion is used only once at the bifurcation point to construct the reduced order model (ROM) which can present the initial postbuckling path of the structure. Hence, the traditional Koiter reduction method is valid asymptotically in the neighborhood of the bifurcation point. The majority of research done in this field applies an expansion of the displacement field up to the second order which is usually accurate enough to capture the initial postbuckling response of structures [16,21–24]. Damil and Potier-Ferry [25] have adopted higher order terms to increase the range of validity of the perturbation expansion further. Increasing the number of higher order terms in the displacement provides a wider range of validity. Yet, the reduced order model obtained from a single perturbation expansion still has a limited range of validity that cannot be determined a priori. In addition, the prebuckling state is assumed to be linear in most of Koiter reduction methods used in [10,15,16,24,26,27], since these methods are based on an alternative procedure proposed in Budiansky and Hutchinson [28], in which the assumption is made that the prebuckling is linear. In reality, this linear assumption for the prebuckling state will often overestimate the buckling load of an important class of engineering problems for which the prebuckling is obviously nonlinear. Cohen [26] and Fitch [27], and later Arbocz and Hol [29,30] have derived the modifications necessary to make Budiansky and Hutchinson׳s work [28] include prebuckling nonlinearity. Recently, Rahman [13,14,17] and Zagari [11,12] have made use of Arbocz and Hol׳s [29,30] derivations within a finite element context to consider the nonlinearity of the prebuckling of a structure.

Apart from Koiter reduction methods which are mainly used in the static buckling analysis of structures, the idea of reduced order models has been studied intensively in the past across various disciplines following different approaches. In particular, projection methods based on Krylov subspace algorithms have a tradition due to the numerically efficient and relatively stable generation of orthogonal projection bases [31–33] often with application in structural vibration [20,34,35] and dynamics [16,36–38]. Other disciplines where reduced order models may significantly alleviate the numerical effort spent in repeated solution steps are fluid mechanics [39–42], aeroelasticity [43,44] or optimization [45,46] to mention a few. An exhaustive overview about reduced order modeling techniques and strategies, about fields of application and the analysis of convergence behavior and error-control is provided e.g. in Chinesta et al. [47] or Quaterioni and Rozza [48].

The aforementioned Koiter reduction methods adopt the solution of the reduced order model as a predictor without using any correction step based on the full model [40,41,49–52]. Another family of model reduction techniques combines the prediction stage together with a correction phase [53–55]. These predictor-corrector methods [56–58] are commonly used to trace the nonlinear equilibrium path of structures. Recently, a novel approach, the Koiter–Newton method, has been proposed for the numerical solution of a class of elastic nonlinear structural analysis problems [59–61]. The range of validity of this approach is not limited to the small range near the bifurcation point, since Koiter׳s asymptotic expansion is applied from the beginning of the equilibrium path rather than only at the bifurcation point. In a series of expansion steps, a reduced order model is constructed based on Koiter׳s asymptotic expansion and used to predict the nonlinear response of the full model. A Newton method is used to correct the prediction if the accuracy of the reduced order model has been lost. In the next expansion step, the reduced order model is updated to reflect any changes in structural stiffness and load distribution. Structural nonlinearities are considered automatically using this multi-expansion strategy. The method favorably combines ideas from Koiter׳s initial post-buckling analysis with Newton arc-length methods to obtain an algorithm that is accurate over the entire equilibrium path and efficient in the presence of buckling and/or imperfection sensitivity. The Newton-based corrector phase of the presented approach uses a few factorizations of the full model. Nevertheless, the high stability of the method even for severe test cases justifies the increased numerical effort of full model on-line calculations [47] and still shows a superior numerical efficiency compared to standard path-follower methods. In [59] we presented the basic idea of the Koiter–Newton approach and demonstrated the numerical efficiency in terms of reliability and accuracy with a number of examples of moderate deformation. A specialization of the Koiter–Newton method for thin plates and shells with negligible in-plane rotations was introduced in [60] considering von Kármán kinematics which neglect higher order terms in the strain tensor components thus reducing the computational complexity of the approach.

With this contribution we extend the Koiter–Newton method to large deformation analysis on the basis of a co-rotational formulation. This allows us to cover a much broader field of applications including solids and structures with a geometrically highly nonlinear response [62–64]. Structures usually undergo a large motion in the presence of buckling, hence geometrically nonlinear mechanics is usually employed in a buckling analysis [4,65–67]. Currently, three Lagrangian kinematic are used for finite element analysis of geometrically nonlinear structures [66,68,63]: (1) a total Lagrangian (TL) formulation, (2) an updated Lagrangian (UL) formulation, and (3) a co-rotational formulation. The latter was the last to be developed [69,70], and the co-rotational formulation which is adopted in this paper has recently received considerable attention. In the beginning, the co-rotational formulation was not designed to be implemented in a general finite element for the nonlinear analysis of structures, since the application of this formulation is limited to an a priori kinematics assumption [66,71] which allows arbitrary large displacements and rotations but which is limited to small deformations [66]. To make the co-rotational formulation more widely applicable, the idea of multiple frames [72] has been proposed for the CR formulation. Instead of one co-rotational frame for a whole structure, each element of a structure is given on independent frame called a co-rotational element frame. This modification helps to ensure the above assumption, achieved by making the element deformational displacements and rotations small with respect to the co-rotational element frame. The application of the co-rotation formulation in Koiter׳s analysis has been studied before by some researchers. Pacoste and Eriksson [73] have investigated the possibility of using co-rotational formulation. Garcea [11] has studied implementing Koiter׳s asymptotic approach in nonlinear structural finite element models which are based on a co-rotational frame. Recently, Zagari [12,74] has presented a co-rotational formulation, suitable for a nonlinear, fourth order accurate asymptotic postbuckling analysis of shell structures, which exploits three dimensional finite rotations. However, the above applications are limited to some traditional Koiter reduction methods, which can only exploit the initial post-buckling response of structures. In the Koiter–Newton approach addressed in this contribution, Koiter׳s asymptotic expansion is applied at any known equilibrium state to construct a reduced order model. In this paper, the co-rotational formulation is adopted and used to achieve equilibrium equations in a third order form. We believe that our approach profits essentially from the co-rotational formulation for various reasons:
                        
                           •
                           the element independent co-rotational frame is computationally more accurate for the case of large displacements and/or large rotations in a geometrically nonlinear analysis, as the rigid part is purged from the total motion.

the co-rotational formulation addresses the accuracy and convergence problems which often occur in the implementation of a Koiter perturbation approach in a finite element context [11,14,75].

the proposed Koiter–Newton approach requires derivatives of the strain energy with respect to degrees of freedom up to the fourth order. This is two orders more than traditionally needed for a Newton׳s method. Nonlinear elements based on the element independent co-rotational frame can facilitate the differentiations [76,77]. The full nonlinear kinematics are taken into account when constructing the reduced order model in this way.

due to the element independent characteristics of the co-rotational frame, any type of linear elements in the current element library can be used for the Koiter–Newton approach, and geometric nonlinearities are taken into account by derivatives of the local co-rotational frame with respect to the global frame.

Based on these characteristics we present the complete formulation for a two-dimensional co-rotational beam element and a co-rotational shell element for large deformation analysis including the required equilibrium equations of a third order form. The formulation considers a large rotation theory to handle the non-commutativity of the finite rotations involved [78–83]. We demonstrate the good performance achieved with the developed method with several benchmark tests. We show that our approach can exactly re-produce large deformation and buckling analysis results of standard path-follower or Newton-type methods with far less effort and with equivalent reliability and accuracy. With a comparison between sophisticated solution schemes from literature and our method we illustrate the competitiveness of our approach.

The paper is organized as follows: a brief review of the Koiter–Newton approach is given in Section 2. The finite element formulation of co-rotational beam and shell elements are presented in Sections 3 and 4, respectively. Numerical examples used to demonstrate the success of the method are provided in Section 5. We summarize the paper and draw conclusions in Section 6.

Let us start with a brief review of the Koiter–Newton approach outlining the essential strategy behind this novel path-tracing technique.

Similar to classical path-following techniques the Koiter–Newton method is based on a step by step procedure to trace the complete equilibrium path of the deforming structure. The unique properties and algorithmic differences compared to standard methods are listed in the following with the help of the flow chart depicted in Figs. 1 and 2
                        
                        .

As shown in Fig. 2, starting from a known nominal equilibrium state, usually the undeformed reference configuration of a structure, a reduced order model is constructed based on Koiter׳s theory which is used to make an initial nonlinear prediction of the response of the structure being analyzed. Compared to traditional Newton methods which use a linear prediction, a significantly larger step size can be achieved using the Koiter–Newton approach due to a better nonlinear prediction provided by the reduced order model, see the red, dashed curve plotted in Fig. 1. Furthermore, the proposed non-linear prediction detects and traces accurately the branching into secondary stability paths at bifurcation points, cf. Fig. 1. This efficient and reliable branch detection is attributed to the implementation of the perturbation loads during the construction of the reduced order model. The perturbation loads related to the buckling modes of the structure trigger a buckling mode which is used to perturb numerically the path-following algorithm and to ensure transition at the bifurcation point to the corresponding secondary equilibrium path.

During the simulation of the reduced order model, the unbalanced force residual at the new predicted location on the equilibrium path is calculated using (1), based on the full finite element model.
                           
                              (1)
                              
                                 
                                    
                                       f
                                    
                                    
                                       r
                                    
                                 
                                 =
                                 λ
                                 
                                    
                                       f
                                    
                                    
                                       ext
                                    
                                 
                                 −
                                 
                                    
                                       f
                                    
                                    
                                       int
                                    
                                 
                              
                           
                        where 
                           
                              
                                 f
                              
                              
                                 int
                              
                           
                         is the internal force of the current iteration step, 
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                         is the total external force and λ is the current load parameter. The internal force calculation is very accurate as it is calculated using the full finite element model.

This residual force 
                           
                              
                                 f
                              
                              
                                 r
                              
                           
                         is used to judge whether the applied reduced order model is sufficiently accurate. The simulation of the reduced order model is stopped for 
                           
                              
                                 f
                              
                              
                                 r
                              
                           
                         being above a given threshold. In a subsequent corrector phase, the residual is driven toward zero in a manner similar to that used in traditional Newton arc-length methods, as indicated in Fig. 1 using a small red arrow. Based on the new found equilibrium state of the structure an updated reduced order model is constructed which is used for further load steps.

There are three basic parts in each expansion step of the Koiter–Newton approach: (1) construction of the reduced order model, (2) iterative solution of the reduced order model, (3) correction of the predicted load-displacement step produced by the reduced order model. During the construction of the reduced order model, a set of augmented linear FEM equations, which will be addressed as (10) and (11) in Section 2.2, needs to be solved. Since all these systems share the same coefficient matrix, only one stiffness matrix factorization is needed. Hence, the computational cost for constructing the reduced order model is almost equivalent to the cost of solving one linear FEM system, assuming that the computational cost is dominated by a factorization and not by a forward and back substitution. Since the scale of the reduced order model is very small, i.e. usually less than ten, the computational effort for the iterative solution using the classical Newton path-following method can be neglected. During the correction of the predicted load-displacement step produced by the reduced order model, some general Newton iterations are used to increase the numerical stability of the procedure. The computational cost for each iteration is equal to the cost of solving a linear FEM system. The total number 
                           N
                         of the linear FEM systems which need to be solved in the Koiter–Newton approach is assessed with:
                           
                              (2)
                              
                                 N
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       p
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 (
                                 1
                                 +
                                 
                                    
                                       N
                                    
                                    
                                       c
                                    
                                    
                                       p
                                    
                                 
                                 )
                              
                           
                        where n is the total number of steps taken by the method, and 
                           
                              
                                 N
                              
                              
                                 c
                              
                              
                                 p
                              
                           
                         is the number of linear FEM systems for correction in step p. The proposed Koiter–Newton approach will significantly improve the efficiency of nonlinear static finite element analysis, especially for buckling sensitive structures as demonstrated in Section 5.

In this section, we briefly illustrate how the reduced order model is constructed based on Koiter׳s theory. Nonlinear equations of equilibrium are used to describe the nonlinear response of a structure. The discretized equilibrium equations are reduced to a set of nonlinear algebraic equations of the form 
                           
                              
                                 f
                              
                              
                                 int
                              
                           
                           (
                           q
                           )
                           =
                           λ
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                        , where 
                           
                              
                                 f
                              
                              
                                 int
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                         are the internal force vector and external force vector, respectively, λ is the load parameter of the analysis, and 
                           q
                         is the vector of primal values, the unknown displacements in our model.

In the proposed Koiter–Newton approach, a reduced order model is established to approximate equilibrium equations in the neighborhood of a known equilibrium state 
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 λ
                              
                              
                                 0
                              
                           
                           )
                        . The vector 
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                         describes the configuration at this equilibrium state, which we will refer to as the known nominal configuration. Let 
                           q
                         be the unknown displacement vector near this nominal state, and 
                           u
                         describes the current configuration with respect to the nominal configuration:
                           
                              (3)
                              
                                 q
                                 =
                                 u
                                 ○
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        where the composition of 
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                         and 
                           u
                         is not always a simple addition, i.e. in the case of 3D large rotations for shells, the composition of rotations is not found by simple addition, see Section 4.

The nonlinear relations are approximated by a Taylor series expansion to the third order with respect to 
                           u
                         in the nominal configuration:
                           
                              (4)
                              
                                 L
                                 (
                                 u
                                 )
                                 +
                                 Q
                                 (
                                 u
                                 ,
                                 u
                                 )
                                 +
                                 C
                                 (
                                 u
                                 ,
                                 u
                                 ,
                                 u
                                 )
                                 +
                                 O
                                 (
                                 
                                    
                                       ‖
                                       
                                          u
                                       
                                       ‖
                                    
                                    
                                       4
                                    
                                 
                                 )
                                 =
                                 Δ
                                 λ
                                 
                                    
                                       f
                                    
                                    
                                       ext
                                    
                                 
                              
                           
                        where 
                           L
                        , 
                           Q
                         and 
                           C
                         denote the linear, quadratic and cubic forms of the approximated elastic forces. These forms can also be considered as a two-dimensional tensor 
                           L
                        , a three-dimensional tensor 
                           Q
                         and a four-dimensional tensor 
                           C
                         of order N, where N is the total number of degrees of freedom in the finite element model. For example, 
                           Q
                           (
                           u
                           ,
                           v
                           )
                           =
                           
                              
                                 Q
                              
                              
                                 pij
                              
                           
                           
                              
                                 u
                              
                              
                                 i
                              
                           
                           
                              
                                 v
                              
                              
                                 j
                              
                           
                        , where the Einstein summation convention is applied. We further use 
                           Δ
                           λ
                           =
                           λ
                           −
                           
                              
                                 λ
                              
                              
                                 0
                              
                           
                         and the fact that 
                           
                              
                                 f
                              
                              
                                 int
                              
                           
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           )
                           =
                           
                              
                                 λ
                              
                              
                                 0
                              
                           
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                        .

The proposed Koiter–Newton technique is aimed at being applicable for buckling sensitive structures. In the presence of buckling, multiple secondary equilibrium branches that intersect with the primary path at bifurcation points exist. For the method to work in such cases, the possibility of some perturbation loads that may excite the secondary branches needs to be taken into account. Thus, the equations of equilibrium (4) may be extended to consider multiple loading of the form:
                           
                              (5)
                              
                                 L
                                 (
                                 u
                                 )
                                 +
                                 Q
                                 (
                                 u
                                 ,
                                 u
                                 )
                                 +
                                 C
                                 (
                                 u
                                 ,
                                 u
                                 ,
                                 u
                                 )
                                 +
                                 O
                                 (
                                 
                                    
                                       ‖
                                       
                                          u
                                       
                                       ‖
                                    
                                    
                                       4
                                    
                                 
                                 )
                                 =
                                 F
                                 ϕ
                              
                           
                        where 
                           F
                         is a load matrix column-wise formed by m+1 load vectors 
                           
                              
                                 f
                              
                              
                                 α
                              
                           
                        , denoted as sub-loads. The first sub-load vector 
                           
                              
                                 f
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                         corresponds the external load. The remaining m load vectors are perturbation loads derived from m closely spaced linear buckling modes of the structure. The selection of perturbation loads will be addressed later. The vector 
                           ϕ
                         represents load amplitudes, the form of which will be presented in (14).

The solution 
                           u
                         of (5) lies, in general, on an m+1 dimensional surface. The numerical construction of such a surface would be computationally prohibitive. To circumvent this, an approximate solution is obtained using a series expansion. The equilibrium surface is parametrized in terms of generalized displacements 
                           ξ
                        , and the equilibrium displacement is expanded to the third order with respect to 
                           ξ
                         as follows:
                           
                              (6)
                              
                                 u
                                 =
                                 
                                    
                                       u
                                    
                                    
                                       α
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       α
                                    
                                 
                                 +
                                 
                                    
                                       u
                                    
                                    
                                       α
                                       β
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       α
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       β
                                    
                                 
                                 +
                                 
                                    
                                       u
                                    
                                    
                                       α
                                       β
                                       γ
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       α
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       β
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       γ
                                    
                                 
                              
                           
                        where the subscripts 
                           α
                           ,
                           β
                           ,
                           γ
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           m
                           +
                           1
                        , and the summation convention is applied. The first order displacements 
                           
                              
                                 u
                              
                              
                                 α
                              
                           
                         define the tangent plane to the equilibrium surface at the approximation point. The second order displacements 
                           
                              
                                 u
                              
                              
                                 α
                                 β
                              
                           
                         and third order displacements 
                           
                              
                                 u
                              
                              
                                 α
                                 β
                                 γ
                              
                           
                         describe the interactions among first and second order displacement fields, respectively.

The equilibrium surface may be parametrized with an infinite number of choices for 
                           ξ
                        . To fix the parameterization, we choose the vector 
                           ξ
                         such that it is work conjugate to the load amplitudes 
                           ϕ
                        , as given by:
                           
                              (7)
                              
                                 
                                    
                                       (
                                       F
                                       ϕ
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 δ
                                 u
                                 ≡
                                 
                                    
                                       ϕ
                                    
                                    
                                       t
                                    
                                 
                                 δ
                                 ξ
                                 .
                              
                           
                        This leads to the following constraint equations:
                           
                              (8)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   β
                                                
                                             
                                             =
                                             
                                                
                                                   δ
                                                
                                                
                                                   α
                                                   β
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   β
                                                   γ
                                                
                                             
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   α
                                                
                                                
                                                   t
                                                
                                             
                                             
                                                
                                                   u
                                                
                                                
                                                   β
                                                   γ
                                                   δ
                                                
                                             
                                             =
                                             0
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 δ
                              
                              
                                 α
                                 β
                              
                           
                         is the Kronecker delta.

Consistent with the displacement expansion, we assume the expansion for the load amplitudes 
                           ϕ
                         to be:
                           
                              (9)
                              
                                 ϕ
                                 =
                                 
                                    
                                       L
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 )
                                 +
                                 
                                    
                                       Q
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 ,
                                 ξ
                                 )
                                 +
                                 
                                    
                                       C
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 ,
                                 ξ
                                 ,
                                 ξ
                                 )
                              
                           
                        where 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                         are still to be determined linear, quadratic and cubic forms of the approximated load amplitudes and represented by a two-dimensional tensor 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                        , a three-dimensional tensor 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                         and a four-dimensional tensor 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                         of order 
                           (
                           1
                           +
                           m
                           )
                        , respectively.

Using the displacement expansion (6) and the load expansion (9) into equilibrium equations (5) and equating the coefficients of the various powers of ξ with zero, and taking orthogonality conditions (8) into account results in the following two sets of governing system of equations:
                           
                              (10)
                              
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   K
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             −
                                             F
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   F
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   α
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         L
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                                
                                                   α
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   E
                                                
                                                
                                                   α
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                              
                           
                        
                        
                           
                              (11)
                              
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   K
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             −
                                             F
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   F
                                                
                                                
                                                   t
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   α
                                                   β
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                                
                                                   α
                                                   β
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             −
                                             Q
                                             (
                                             
                                                
                                                   u
                                                
                                                
                                                   α
                                                
                                             
                                             ,
                                             
                                                
                                                   u
                                                
                                                
                                                   β
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                              
                           
                        where 
                           
                              
                                 K
                              
                              
                                 t
                              
                           
                           =
                           L
                         is the tangent stiffness matrix, where 
                           
                              
                                 E
                              
                              
                                 α
                              
                           
                         is the α-th unit vector with coefficient 
                           
                              
                                 e
                              
                              
                                 α
                              
                           
                           =
                           1
                         and all other coefficients being zero, and where 
                           
                              
                                 
                                    
                                       L
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 α
                              
                           
                         and 
                           
                              
                                 
                                    
                                       Q
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 α
                                 β
                              
                           
                         represent column vectors of order 
                           (
                           1
                           +
                           m
                           )
                         of the multi dimensional tensors 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                         and 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                        , respectively.

The two sets of linear systems of equations, (10) and (11), have identical coefficient matrices, hence factorization is needed only once to construct the reduced order model. The dimension of the coefficient matrix is 
                           (
                           N
                           +
                           1
                           +
                           m
                           )
                        , where N is the number of degrees of freedom in the full finite element model and 
                           (
                           1
                           +
                           m
                           )
                         is the number of degrees of freedom in the reduced order model. Since 1+m is generally very small compared to N, these two sets of systems can be regarded as augmented linear FEM equations [84].

In addition to (10) and (11) the load and displacement expansion results in the relation:
                           
                              (12)
                              
                                 
                                    
                                       
                                          
                                             C
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       α
                                       β
                                       γ
                                       δ
                                    
                                 
                                 =
                                 C
                                 (
                                 
                                    
                                       u
                                    
                                    
                                       α
                                    
                                 
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       β
                                    
                                 
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       γ
                                    
                                 
                                 ,
                                 
                                    
                                       u
                                    
                                    
                                       δ
                                    
                                 
                                 )
                                 −
                                 
                                    
                                       2
                                    
                                    
                                       3
                                    
                                 
                                 [
                                 
                                    
                                       
                                          u
                                       
                                       
                                          α
                                          β
                                       
                                       
                                          t
                                       
                                    
                                    L
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          δ
                                          γ
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          u
                                       
                                       
                                          β
                                          γ
                                       
                                       
                                          t
                                       
                                    
                                    L
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          δ
                                          α
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          u
                                       
                                       
                                          γ
                                          α
                                       
                                       
                                          t
                                       
                                    
                                    L
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          δ
                                          β
                                       
                                    
                                    )
                                 
                                 ]
                              
                           
                        where 
                           
                              
                                 
                                    
                                       C
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 α
                                 β
                                 γ
                                 δ
                              
                           
                         denote the components of 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                        .

The relation (12) does not need a factorization. The solution of (10)–(12) obtains the unknown displacements 
                           
                              
                                 u
                              
                              
                                 α
                              
                           
                        , 
                           
                              
                                 u
                              
                              
                                 α
                                 β
                              
                           
                         and the unknown components of 
                           
                              
                                 L
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 Q
                              
                              
                                 ¯
                              
                           
                        , 
                           
                              
                                 C
                              
                              
                                 ¯
                              
                           
                        . At this point, the expansion (9) of load amplitudes is achieved. We rewrite it in the following form, to get the reduced order model of order 1+m:
                           
                              (13)
                              
                                 
                                    
                                       L
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 )
                                 +
                                 
                                    
                                       Q
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 ,
                                 ξ
                                 )
                                 +
                                 
                                    
                                       C
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 ξ
                                 ,
                                 ξ
                                 ,
                                 ξ
                                 )
                                 =
                                 ϕ
                              
                           
                        where the left hand side of (13) has already been obtained after solving (10)–(12). The right hand side, which is the load amplitudes 
                           ϕ
                        , can be expressed by the load parameter 
                           Δ
                           λ
                         in the equilibrium Eq. (4) as:
                           
                              (14)
                              
                                 ϕ
                                 =
                                 Δ
                                 λ
                                 
                                    
                                       E
                                    
                                    
                                       1
                                    
                                 
                              
                           
                        where 
                           
                              
                                 E
                              
                              
                                 1
                              
                           
                         is the 1st unit vector. The dimension of the load amplitudes 
                           ϕ
                         is 1+m. The first component 
                           Δ
                           λ
                         is the increment of the parameter for external load 
                           
                              
                                 f
                              
                              
                                 1
                              
                           
                        . The other components are parameters of the perturbation loads 
                           
                              
                                 f
                              
                              
                                 α
                              
                           
                           ,
                           α
                           =
                           2
                           ,
                           …
                           ,
                           m
                           +
                           1
                         and all are set equal to zero to simulate the response of the structure to actual loads.

As shown in Fig. 2, if the buckling does not happen in the analysis, only the external load and 
                           Δ
                           λ
                         need to be considered and there will be only one degree of freedom in the reduced order model. Otherwise, the perturbation loads 
                           
                              
                                 f
                              
                              
                                 α
                              
                           
                           ,
                           α
                           =
                           2
                           ,
                           …
                           ,
                           m
                           +
                           1
                         are used to excite the buckling branches, where m is the number of closely spaced buckling modes of the analyzed structure.

The construction of the perturbation loads is related to the buckling modes of the structure. The buckling modes are found from a linear buckling analysis which requires the solution of the generalized eigenvalue problem 
                           (
                           
                              
                                 K
                              
                              
                                 t
                              
                           
                           +
                           
                              
                                 μ
                              
                              
                                 α
                              
                           
                           
                           
                              
                                 K
                              
                              
                                 g
                              
                           
                           )
                           x
                           =
                           0
                         at the approximation point, in which 
                           
                              
                                 K
                              
                              
                                 t
                              
                           
                         is the tangent stiffness matrix, 
                           
                              
                                 K
                              
                              
                                 g
                              
                           
                         is the geometric stiffness matrix, in which 
                           
                              
                                 μ
                              
                              
                                 α
                              
                           
                         is the coefficient of the buckling load 
                           (
                           
                              
                                 μ
                              
                              
                                 α
                              
                           
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                           )
                         and 
                           x
                         is the corresponding buckling mode. The geometric matrix 
                           
                              
                                 K
                              
                              
                                 g
                              
                           
                         is calculated using the form 
                           −
                           2
                           Q
                           (
                           
                              
                                 q
                              
                              
                                 ,
                                 λ
                              
                           
                           )
                        , where 
                           
                              
                                 q
                              
                              
                                 ,
                                 λ
                              
                           
                         is the linear displacement of the structure under the external load 
                           
                              
                                 f
                              
                              
                                 ext
                              
                           
                         and 
                           Q
                         is the quadratic form of the approximated elastic forces in (4). The perturbation load is calculated by the multiplication of the geometric stiffness and the buckling mode. In this way, the buckling shapes of the structure are introduced into the algorithm as a kind of numerical perturbation, due to the use of the perturbation loads. For the interested reader this part is discussed in detail in [59].

If the structure has many closely spaced buckling modes, buckling modes associated with simultaneous or nearly simultaneous buckling loads, these closely spaced modes will interact and influence the buckling characteristics of the structure. So the selection of perturbation loads should also consider this case. As a simple rule, buckling modes with buckling loads within 120% of the first buckling load are considered to be closely spaced buckling modes and used to construct the perturbation loads.

Using the solution of the reduced order model the relation between the load parameter 
                           Δ
                           λ
                         and the displacement parameter 
                           ξ
                         can be found from (13). In order to get the nonlinear response about λ and 
                           q
                        , the definition 
                           λ
                           =
                           
                              
                                 λ
                              
                              
                                 0
                              
                           
                           +
                           Δ
                           λ
                         and Eq. (3) are used and a displacement expansion (6) only up to the second order is invoked.

From the discussion above, it can be seen that the difficulty for a finite element implementation of the Koiter–Newton approach is to obtain the expression of equilibrium equations in a third order form (5) in the known nominal configuration, which needs the derivatives of the strain energy up to the fourth order, since in the general nonlinear finite element technique we only use the derivatives up to the second order. In this paper, we focus on discussing how these high-order derivatives are achieved using the co-rotational formulation in the nominal configuration, in the following Sections 3 and 4.

A classical linear Euler beam element together with an element-independent co-rotational frame is used to demonstrate the finite element implementation of the Koiter–Newton approach in this section.

We introduce the descriptions of the beam element in a co-rotational frame. Based on this frame we provide local and global degrees of freedom for the beam element which allows us to extract the deformational part of the total motion by purging the rigid part before the element computations.

A complete description of a co-rotational beam element using Kirchhoff theory is presented in Crisfield׳s book [68]. The deformation of a 2-D beam element from the initial undeformed configuration to the nominal deformed configuration is shown in Fig. 3
                        . The two nodes of the beam element are denoted a and b. Three degrees of freedom are specified at each node which are two translations u, v and one rotation θ. The beam configurations are referred to the global Cartesian coordinates system (x,y) with basis vectors 
                           x
                        , 
                           y
                         as depicted in Fig. 3. In Fig. 3, θ is the angle between the nominal configuration and the global x-axis, θ
                        0 is the angle between the reference configuration and the global x-axis, and 
                           Δ
                           θ
                         is the angle between the initial and current configurations.

In the nominal configuration the beam element is described in an axis aligned local coordinates system with the unit vectors 
                           
                              
                                 e
                              
                              
                                 x
                              
                           
                        , 
                           
                              
                                 e
                              
                              
                                 y
                              
                           
                         as basis vectors. The basis vector 
                           
                              
                                 e
                              
                              
                                 x
                              
                           
                         is aligned with the coordinate direction from node a to node b. The local coordinate system co-rotates with the element movement in the 2D plane.

The global degrees of freedom of the beam element in the global coordinate system (x,y) are given as:
                           
                              (15)
                              
                                 q
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                u
                                             
                                             
                                                a
                                             
                                          
                                          
                                          
                                             
                                                v
                                             
                                             
                                                a
                                             
                                          
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                a
                                             
                                          
                                          
                                          
                                             
                                                u
                                             
                                             
                                                b
                                             
                                          
                                          
                                          
                                             
                                                v
                                             
                                             
                                                b
                                             
                                          
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                b
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

In the case of large displacements and/or large rotations, the global degrees of freedom of the structure contain the rigid motion and the deformational part. Since the strain energy is only related to the deformational part, we need to pick up the local degrees of freedom which are related to the deformation, using the co-rotational frame, which results in:
                           
                              (16)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ^
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          0
                                          
                                          0
                                          
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                b
                                             
                                          
                                          
                                          0
                                          
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                b
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                              
                           
                        where, the two local translations 
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                        , 
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         of node a and the local vertical translation 
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 b
                              
                           
                         of node b are always equal to zero during the deformation of the element, due to the definition of the local co-rotational element frame. In (16), local rotations 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         and 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 b
                              
                           
                         can also be called local co-rotational slopes [68].

The local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         of the beam element can be reduced to:
                           
                              (17)
                              
                                 
                                    
                                       q
                                    
                                    
                                       ^
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                b
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                b
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

It can be seen from Fig. 3 that global and local degrees of freedom should satisfy the following geometrical relations, given by:
                           
                              (18)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   b
                                                
                                             
                                             =
                                             
                                                
                                                   l
                                                
                                                
                                                   n
                                                
                                             
                                             −
                                             l
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                             
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   a
                                                
                                             
                                             −
                                             Δ
                                             θ
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   a
                                                
                                             
                                             −
                                             (
                                             θ
                                             −
                                             
                                                
                                                   θ
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   a
                                                
                                             
                                             −
                                             θ
                                             +
                                             
                                                
                                                   θ
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   b
                                                
                                             
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   b
                                                
                                             
                                             −
                                             Δ
                                             θ
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   b
                                                
                                             
                                             −
                                             (
                                             θ
                                             −
                                             
                                                
                                                   θ
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   θ
                                                
                                                
                                                   b
                                                
                                             
                                             −
                                             θ
                                             +
                                             
                                                
                                                   θ
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where the l and l
                        
                           n
                         are the initial and current length of the beam element, respectively, θ is the angle between the current configuration and the x-axis of the global coordinate system, θ
                        0 is the angle between the initial configuration and the x-axis, and 
                           Δ
                           θ
                         is the angle between the initial and current configurations, as shown in Fig. 3.

We denote the position vectors of nodes a and b in the reference configuration with 
                           
                              
                                 r
                              
                              
                                 a
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 b
                              
                           
                        , respectively, and the position vectors in the nominal configuration with 
                           
                              
                                 d
                              
                              
                                 a
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 b
                              
                           
                        , respectively, see Fig. 4
                        . Then, the current length l
                        
                           n
                         of the beam element can be expressed as:
                           
                              (19)
                              
                                 
                                    
                                       l
                                    
                                    
                                       n
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       l
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 
                                    
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             b
                                          
                                       
                                       −
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       b
                                    
                                 
                                 −
                                 
                                    
                                       r
                                    
                                    
                                       a
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       (
                                       
                                          
                                             d
                                          
                                          
                                             b
                                          
                                       
                                       −
                                       
                                          
                                             d
                                          
                                          
                                             a
                                          
                                       
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       d
                                    
                                    
                                       b
                                    
                                 
                                 −
                                 
                                    
                                       d
                                    
                                    
                                       a
                                    
                                 
                                 )
                                 .
                              
                           
                        
                     

The strain of the beam element is expressed as:
                           
                              (20)
                              
                                 ε
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       l
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                       −
                                       l
                                    
                                    
                                       l
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             l
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       l
                                       (
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                       +
                                       l
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       −
                                       
                                          
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   b
                                                
                                             
                                             −
                                             
                                                
                                                   r
                                                
                                                
                                                   a
                                                
                                             
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             b
                                          
                                       
                                       −
                                       
                                          
                                             r
                                          
                                          
                                             a
                                          
                                       
                                       )
                                       +
                                       
                                          
                                             (
                                             
                                                
                                                   d
                                                
                                                
                                                   b
                                                
                                             
                                             −
                                             
                                                
                                                   d
                                                
                                                
                                                   a
                                                
                                             
                                             )
                                          
                                          
                                             t
                                          
                                       
                                       (
                                       
                                          
                                             d
                                          
                                          
                                             b
                                          
                                       
                                       −
                                       
                                          
                                             d
                                          
                                          
                                             a
                                          
                                       
                                       )
                                    
                                    
                                       l
                                       (
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                       +
                                       l
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

The curvature of the beam element can be given as [85]:
                           
                              (21)
                              
                                 κ
                                 =
                                 (
                                 
                                    −
                                    
                                       
                                          4
                                       
                                       
                                          l
                                       
                                    
                                    +
                                    6
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 +
                                 (
                                 
                                    −
                                    
                                       
                                          2
                                       
                                       
                                          l
                                       
                                    
                                    +
                                    6
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                l
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 )
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       b
                                    
                                 
                              
                           
                        
                     

The strain energy of the beam element is first given based on the descriptions of the beam element in Section 3.1, then 
                           L
                        , 
                           Q
                         and 
                           C
                         of equilibrium equations of a third order form (5) are obtained by differentiating the strain energy with respect to the global degrees of freedom.


                        Strain energy – beam model: The strain energy of the beam element can be obtained by introducing the strain (20) and the curvature (21) into the expression of the strain energy and integrating along the length of the beam, which results in:
                           
                              (22)
                              
                                 
                                    
                                       U
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       ∫
                                    
                                    
                                       0
                                    
                                    
                                       l
                                    
                                 
                                 (
                                 
                                    
                                       
                                          κ
                                       
                                       
                                          t
                                       
                                    
                                    EI
                                    κ
                                    +
                                    
                                       
                                          ε
                                       
                                       
                                          t
                                       
                                    
                                    EA
                                    ε
                                 
                                 )
                                 dx
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 EAl
                                 
                                    
                                       ε
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       2
                                       EI
                                    
                                    
                                       l
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          a
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                       
                                          2
                                       
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 EA
                                 
                                    
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       l
                                    
                                 
                                 +
                                 
                                    
                                       2
                                       EI
                                    
                                    
                                       l
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          a
                                       
                                       
                                          2
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          b
                                       
                                       
                                          2
                                       
                                    
                                 
                                 )
                              
                           
                        where E is the Young׳s modulus, and A is the area of the cross section. Since the strain energy (22) is a quadratic function of local degrees of freedom, the derivatives of the strain energy are only up to the second order. The first order derivative of the strain energy with respect to local degrees of freedom is the local internal load:
                           
                              (23)
                              
                                 
                                    
                                       f
                                    
                                    
                                       ^
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   EA
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        u
                                                                     
                                                                     
                                                                        ^
                                                                     
                                                                  
                                                               
                                                               
                                                                  b
                                                               
                                                            
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         
                                                            2
                                                            EI
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      2
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   )
                                                   ,
                                                   
                                                      
                                                         
                                                            2
                                                            EI
                                                         
                                                         
                                                            l
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                      +
                                                      2
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

The second order derivative of the strain energy provides the linear stiffness matrix of the beam element:
                           
                              (24)
                              
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      EA
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      4
                                                      EI
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      2
                                                      EI
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      2
                                                      EI
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      4
                                                      EI
                                                   
                                                   
                                                      l
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 .
                              
                           
                        
                     

After obtaining the expression of the strain energy 
                           
                              
                                 U
                              
                              
                                 ¯
                              
                           
                        , the internal load vector 
                           f
                        , the tangent stiffness matrix 
                           L
                        , the three-dimensional matrix 
                           Q
                         and the four-dimensional matrix 
                           C
                         can be achieved using the first to fourth order derivatives of the strain energy with respect to global degrees of freedom 
                           q
                        . Since the strain energy is an explicit function of local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        , we should differentiate the strain energy with respect to local degrees of freedom first and then multiply the derivatives of the local degrees of freedom with respect to the global degrees of freedom. Using (23) and (24), components of 
                           f
                        , 
                           L
                        , 
                           Q
                         and 
                           C
                         can be expressed as follows:
                           
                              (25)
                              
                                 
                                    
                                       f
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       L
                                    
                                    
                                       pi
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (27)
                              
                                 2
                                 
                                    
                                       Q
                                    
                                    
                                       pij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 6
                                 
                                    
                                       C
                                    
                                    
                                       pijk
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             4
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             3
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             4
                                          
                                       
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             m
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             p
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        where the subscripts p, i, j, k, m and n run from 1 to 6, with 6 being the number of total degrees of freedom in a beam element. Note the summation convention is only applied on m and n.

Eqs. (25)–(28) demonstrate that any linear beam element with a given 
                           
                              
                                 K
                              
                              
                                 L
                              
                           
                         can be implemented into the Koiter–Newton approach, and the geometric nonlinearity of the element is taken into account by derivatives of the local co-rotational frame 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         with respect to global degrees of freedom 
                           q
                        , which is independent of the element type.

After obtaining expressions of 
                           L
                        , 
                           Q
                         and 
                           C
                         from (25)–(28) and substituting them into (5), equilibrium equations in a third order form for the beam element are achieved, however, the derivatives of local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         with respect to global degrees of freedom 
                           q
                         in (25)–(28) are still unknown, these are discussed in the following subsection.


                        Derivatives of local degrees of freedom: The first order derivative of local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         
                        (17) with respect to global degrees of freedom 
                           q
                         is a 
                           (
                           3
                           ×
                           6
                           )
                         matrix:
                           
                              (29)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       ∂
                                       q
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            6
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            a
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            6
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ^
                                                               
                                                            
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            6
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 
                                 i
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 6
                                 .
                              
                           
                        
                     

In the same way we can now derive the second to fourth order derivatives of the local degrees of freedom with respect to the global degrees of freedom which will result in a three-dimensional matrix of dimension 
                           (
                           3
                           ×
                           6
                           ×
                           6
                           )
                        , a four-dimensional matrix 
                           (
                           3
                           ×
                           6
                           ×
                           6
                           ×
                           6
                           )
                         and a five-dimensional matrix of 
                           (
                           3
                           ×
                           6
                           ×
                           6
                           ×
                           6
                           ×
                           6
                           )
                        . These matrices are formed by derivatives of the three components in 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        , which are here listed only to the second order forms:
                           
                              (30)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 ,
                                 …
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             1
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             3
                                          
                                       
                                       
                                          
                                             0
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             6
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             others
                                          
                                       
                                    
                                 
                                 ;
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             0
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             ,
                                             j
                                             =
                                             3
                                             ,
                                             6
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             ,
                                             j
                                             =
                                             others
                                          
                                       
                                    
                                 
                                 ,
                                 …
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             1
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             3
                                          
                                       
                                       
                                          
                                             0
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             6
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             others
                                          
                                       
                                    
                                 
                                 ;
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             0
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             ,
                                             j
                                             =
                                             3
                                             ,
                                             6
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             i
                                             ,
                                             j
                                             =
                                             others
                                          
                                       
                                    
                                 
                                 ,
                                 …
                              
                           
                        where the subscripts i and j run from 1 to 6, and where we consider the fact that the geometrical relations (18) are used.

From Eqs. (30)–(32) it can be seen that the unknown terms are converted into the derivatives of the current length l
                        
                           n
                         and the rigid rotation θ of the beam element with respect to global degrees of freedom. A detailed description of how to calculate these two unknown groups of derivatives is given below.

Referring to Fig. 3, the following geometrical relation can be easily found in a triangle formed using the current configuration of the beam and the x-axis of the coordinate system, which results in:
                           
                              (33)
                              
                                 [
                                 
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                    
                                    cos
                                    
                                    θ
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                    
                                    sin
                                    
                                    θ
                                 
                                 ]
                                 =
                                 
                                    
                                       d
                                    
                                    
                                       b
                                    
                                 
                                 −
                                 
                                    
                                       d
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 Δ
                                 r
                                 (
                                 q
                                 )
                              
                           
                        where the vector 
                           Δ
                           r
                           (
                           q
                           )
                         is related to global degrees of freedom 
                           {
                           
                              
                                 
                                    u
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    u
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    b
                                 
                              
                           
                           }
                        , and can be expressed by:
                           
                              (34)
                              
                                 Δ
                                 r
                                 (
                                 q
                                 )
                                 =
                                 [
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          0
                                          b
                                       
                                    
                                    −
                                    
                                       
                                          x
                                       
                                       
                                          0
                                          a
                                       
                                    
                                    )
                                    +
                                    (
                                    
                                       
                                          u
                                       
                                       
                                          b
                                       
                                    
                                    −
                                    
                                       
                                          u
                                       
                                       
                                          a
                                       
                                    
                                    )
                                    
                                    (
                                    
                                       
                                          y
                                       
                                       
                                          0
                                          b
                                       
                                    
                                    −
                                    
                                       
                                          y
                                       
                                       
                                          0
                                          a
                                       
                                    
                                    )
                                    +
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          b
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          a
                                       
                                    
                                    )
                                 
                                 ]
                              
                           
                        where 
                           (
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                    a
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    0
                                    a
                                 
                              
                           
                           )
                         and 
                           (
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                    b
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    0
                                    b
                                 
                              
                           
                           )
                         are the coordinates of nodes a and b, respectively, in the reference configuration.

Differentiating (33) with respect to global degrees of freedom, the following equation is obtained:
                           
                              (35)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 [
                                 
                                    cos
                                    
                                    θ
                                    
                                    sin
                                    
                                    θ
                                 
                                 ]
                                 +
                                 
                                    
                                       l
                                    
                                    
                                       n
                                    
                                 
                                 [
                                 
                                    −
                                    sin
                                    
                                    θ
                                    
                                    cos
                                    
                                    θ
                                 
                                 ]
                                 
                                    
                                       ∂
                                       θ
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       Δ
                                       r
                                       (
                                       q
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        where the right hand side is a constant vector obtained by differentiating (34), which leads to:
                           
                              (36)
                              
                                 
                                    
                                       Δ
                                       r
                                       (
                                       q
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             [
                                             
                                                −
                                                1
                                                
                                                0
                                             
                                             ]
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             [
                                             
                                                0
                                                
                                                −
                                                1
                                             
                                             ]
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             2
                                          
                                       
                                       
                                          
                                             [
                                             
                                                1
                                                
                                                0
                                             
                                             ]
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             4
                                          
                                       
                                       
                                          
                                             [
                                             
                                                0
                                                
                                                1
                                             
                                             ]
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             5
                                          
                                       
                                       
                                          
                                             [
                                             
                                                0
                                                
                                                0
                                             
                                             ]
                                          
                                          
                                             if
                                             
                                             i
                                             =
                                             3
                                             ,
                                             6
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

Then, if both sides of (35) are multiplied by a vector 
                           
                              
                                 [
                                 
                                    cos
                                    
                                    θ
                                    
                                    sin
                                    
                                    θ
                                 
                                 ]
                              
                              
                                 t
                              
                           
                        , the first order derivative of the current length l
                        
                           n
                         of the beam element with respect to global degrees of freedom is obtained as:
                           
                              (37)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             l
                                          
                                          
                                             n
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       Δ
                                       r
                                       (
                                       q
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       [
                                       
                                          cos
                                          
                                          θ
                                          
                                          sin
                                          
                                          θ
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

Next, if both sides of (35) are multiplied by a vector 
                           
                              
                                 [
                                 
                                    −
                                    sin
                                    
                                    θ
                                    
                                    cos
                                    
                                    θ
                                 
                                 ]
                              
                              
                                 t
                              
                           
                        , the first order derivative of the rigid rotation θ with respect to global degrees of freedom can be achieved:
                           
                              (38)
                              
                                 
                                    
                                       l
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       ∂
                                       θ
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       Δ
                                       r
                                       (
                                       q
                                       )
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       [
                                       
                                          −
                                          sin
                                          
                                          θ
                                          
                                          cos
                                          
                                          θ
                                       
                                       ]
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

In the same way, the other derivatives of the current length l
                        
                           n
                         and the rigid rotation θ with respect to global degrees of freedom can be achieved. We provide the higher order derivations in Appendix A.

At this point all of the essential derivatives have been obtained, and introducing them into Eqs. (25)–(28) will give the equilibrium equations in a third order form for the co-rotational beam element. Following the procedures outlined in Section 2.2, the reduced order model using the co-rotational beam element can now be constructed using the 
                           L
                        , 
                           Q
                         and 
                           C
                         in the equilibrium equations (5).

As pointed out in Section 1, 3D large rotations may appear for shells that are non-commutative and thus introduce an additional complexity in the formulation. Argyris discussed this challenge stating that “commutativity, which is one of the three essential properties of a vector, is not satisfied for two or more finite rotations about arbitrary axes in space since the sequential order of their imposition determines in each case a different result and this non-commutativity of finite rotations is, however, not only characteristic of truly large rotations but it holds even when second order effects have to be considered” [78]. We split the degrees of freedom of the shell into a translational part and a rotational part to handle this issue and to obtain a proper presentation of the derivatives needed. We use a classical linear shell element according to the theory of Kirchhoff with an element-independent co-rotational frame.


                        Deformation gradient: A quadrilateral four-node flat shell element with six degrees of freedom per node is shown in Fig. 5
                        . Two known configurations of this shell element during the deformation are defined, where the reference configuration is the initial undeformed configuration and the nominal configuration is the latest known configuration. In the initial step, the nominal configuration is just the reference configuration.

There are several choices to define the co-rotational element frame [68,69]. Here we use the straight lines which are defined by the mid-points of two opposite sides as the coordinate axes 1 and 2, the third axis is naturally orthogonal to the plane formed by the axes 1 and 2. As shown in Fig. 5, we assume matrix 
                           
                              
                                 T
                              
                              
                                 0
                              
                           
                           =
                           [
                           
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                                 
                                    0
                                 
                              
                              
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                                 
                                    0
                                 
                              
                              
                              
                                 
                                    d
                                 
                                 
                                    3
                                 
                                 
                                    0
                                 
                              
                           
                           ]
                         and matrix 
                           T
                           =
                           [
                           
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              
                              
                                 
                                    d
                                 
                                 
                                    3
                                 
                              
                           
                           ]
                         to be the co-rotational element frames in the reference and nominal configurations, respectively, which satisfies the following relationships:
                           
                              (39)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                             
                                             =
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                             
                                             ×
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   3
                                                
                                             
                                             =
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                             
                                             ×
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 d
                              
                              
                                 1
                              
                           
                        , 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                        , 
                           
                              
                                 d
                              
                              
                                 3
                              
                           
                         denote the basis vectors in the nominal configuration and where 
                           
                              
                                 d
                              
                              
                                 1
                              
                              
                                 0
                              
                           
                        , 
                           
                              
                                 d
                              
                              
                                 2
                              
                              
                                 0
                              
                           
                        , 
                           
                              
                                 d
                              
                              
                                 3
                              
                              
                                 0
                              
                           
                         denote the basis vectors in the reference configuration.

The deformation gradient 
                           F
                         represents the gradient of the mapping function related to both, the reference and nominal configurations. In order to find the deformation gradient, we assume that two arbitrary vectors, 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                         and 
                           a
                        , are located in the reference and nominal configurations, respectively, and that they are in the same position relative to their own co-rotational frames, given as:
                           
                              (40)
                              
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                             =
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                             
                                             +
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                                
                                                   0
                                                
                                             
                                             +
                                             
                                                
                                                   a
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   3
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             a
                                             =
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   a
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   a
                                                
                                                
                                                   3
                                                
                                             
                                             
                                                
                                                   d
                                                
                                                
                                                   3
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 a
                              
                              
                                 3
                              
                           
                         are the vector coordinates.

Using (40), vector 
                           a
                         can be expressed by 
                           
                              
                                 a
                              
                              
                                 0
                              
                           
                        , as follows:
                           
                              (41)
                              
                                 a
                                 =
                                 [
                                 
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                    
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          d
                                       
                                       
                                          3
                                       
                                    
                                 
                                 ]
                                 
                                    
                                       [
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                3
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                                 .
                              
                           
                        
                     

In (41), the mapping function related to these two vectors is the deformation gradient, as given by:
                           
                              (42)
                              
                                 F
                                 =
                                 [
                                 
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                    
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                    
                                    
                                       
                                          d
                                       
                                       
                                          3
                                       
                                    
                                 
                                 ]
                                 
                                    
                                       [
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                3
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     

The deformation gradient can be decomposed, using the polar decomposition theorem, into a product of two second-order tensors: an orthogonal rotation tensor and a positive definite symmetric deformation tensor:
                           
                              (43)
                              
                                 F
                                 =
                                 RU
                              
                           
                        where the orthogonal matrix 
                           R
                         represents the pure rotational part of the total motion, and where the symmetric tension matrix 
                           U
                         indicates the pure deformation part of the total motion.

Matrix U is obtained by multiplying 
                           
                              
                                 F
                              
                              
                                 t
                              
                           
                         on both sides of (43):
                           
                              (44)
                              
                                 
                                    
                                       F
                                    
                                    
                                       t
                                    
                                 
                                 F
                                 =
                                 
                                    
                                       F
                                    
                                    
                                       t
                                    
                                 
                                 RU
                                 =
                                 
                                    
                                       UR
                                    
                                    
                                       t
                                    
                                 
                                 RU
                                 =
                                 UU
                              
                           
                        where the orthonormal relation 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           R
                           =
                           I
                         is used.

Using (43) the rotation matrix 
                           R
                         is:
                           
                              (45)
                              
                                 R
                                 =
                                 
                                    
                                       FU
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     


                        Local translations: Global and local degrees of freedom of the shell element are expressed by two vectors of dimension 
                           (
                           24
                           ×
                           1
                           )
                        , 
                           q
                         and 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        , respectively. Global degrees of freedom are measured in the global coordinate system 
                           
                              
                                 T
                              
                              
                                 g
                              
                           
                           =
                           [
                           
                              X
                              
                              Y
                              
                              Z
                           
                           ]
                         in Fig. 5, and local degrees of freedom are measured in the co-rotational shell frame by purging the rigid motion.

For a convenient description, degrees of freedom are divided into two parts, a translational and a rotational part. For each node a 
                        
                           (
                           a
                           =
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                           )
                        , the (3×1) vectors 
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                         and 
                           
                              
                                 θ
                              
                              
                                 a
                              
                           
                         are used to denote the translation and rotation parts of the global degrees of freedom, respectively, and 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         and 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         represent the translation and rotation parts of the local degrees of freedom, respectively, both discussed in the following.

We assume a vector 
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                         in the global frame 
                           
                              
                                 T
                              
                              
                                 g
                              
                           
                         to be the position vector of node a in the reference configuration, see Fig. 5, and 
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                         is the global translation of this vector from the reference configuration to the nominal configuration, hence the position of the new vector in the nominal configuration is 
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                           +
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                        . Then, 
                           
                              
                                 T
                              
                              
                                 t
                              
                           
                           (
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                           +
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                           )
                         is the local position of this new vector under the nominal co-rotational frame 
                           T
                        , which is equal to:
                           
                              (46)
                              
                                 
                                    
                                       T
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       a
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                              
                           
                        where 
                           
                              
                                 T
                              
                              
                                 0
                              
                              
                                 t
                              
                           
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                         is the local position of the initial vector 
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                         in the reference configuration, and 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         is the local translation. The co-rotational frame 
                           
                              
                                 T
                              
                              
                                 0
                              
                           
                         in the reference configuration and the co-rotational frame 
                           T
                         in the nominal configuration satisfy the following relationship:
                           
                              (47)
                              
                                 T
                                 =
                                 
                                    
                                       RT
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        where 
                           R
                         is the average rotation matrix of the shell element.

Substituting (47) into (46), the expression of the local translation 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         is obtained:
                           
                              (48)
                              
                                 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       a
                                    
                                 
                                 +
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 −
                                 I
                                 )
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        where 
                           
                              
                                 r
                              
                              
                                 a
                              
                              
                                 0
                              
                           
                           ,
                           a
                           =
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                         is the position vector of each node in the reference configuration.


                        Local rotations: As shown in Fig. 6
                        , an unknown current configuration which is close to the nominal configuration is introduced, excepting the reference and nominal configurations, to make a better description of the 3D finite rotation case. Based on these three configurations, the global degrees of freedom 
                           q
                         that present the total displacement from the reference configuration to the current configuration can be divided into two parts, which are the relative displacement 
                           
                              
                                 q
                              
                              
                                 n
                              
                           
                         from the reference configuration to the nominal configuration and the relative displacement 
                           u
                         from the nominal configuration to the current configuration, as given by:
                           
                              (49)
                              
                                 q
                                 =
                                 u
                                 ○
                                 
                                    
                                       q
                                    
                                    
                                       n
                                    
                                 
                              
                           
                        where, as mentioned in (3), the composition ○ for rotations in the displacement is not a simple addition in the case of finite rotations, and will depend on the parametrization of the rotations.

In the Cartesian coordinate system, an arbitrary rotation 
                           ϑ
                           =
                           [
                           
                              φ
                              
                              χ
                              
                              ψ
                           
                           ]
                         can be represented by a corresponding rotation matrix 
                           R
                        . Then, after rotating a vector 
                           p
                         by 
                           ϑ
                        , a new vector 
                           
                              
                                 p
                              
                              
                                 ′
                              
                           
                         can be obtained [78]:
                           
                              (50)
                              
                                 
                                    
                                       p
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 R
                                 p
                              
                           
                        where the rotation matrix 
                           R
                         is an orthogonal matrix, and this nonlinear rotation matrix is a nonlinear function of the rotation 
                           ϑ
                        , as given by:
                           
                              (51)
                              
                                 R
                                 =
                                 exp
                                 (
                                 
                                    
                                       
                                          ϑ
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 )
                                 =
                                 I
                                 +
                                 
                                    
                                       ϑ
                                    
                                    
                                       ˜
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       2
                                       !
                                    
                                 
                                 
                                    
                                       
                                          
                                             ϑ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       1
                                    
                                    
                                       3
                                       !
                                    
                                 
                                 
                                    
                                       
                                          
                                             ϑ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 +
                                 ⋯
                              
                           
                        where it can degenerate to the familiar infinitesimal rotation matrix, given by:
                           
                              (52)
                              
                                 R
                                 =
                                 exp
                                 (
                                 
                                    
                                       
                                          ϑ
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 )
                                 ≈
                                 I
                                 +
                                 
                                    
                                       ϑ
                                    
                                    
                                       ˜
                                    
                                 
                              
                           
                        where matrix 
                           I
                         is a (3×3) identity matrix, the operator 
                           exp
                           (
                           
                              …
                           
                           )
                         means applying an exponent operation on the matrix in the bracket, and matrix 
                           
                              
                                 ϑ
                              
                              
                                 ˜
                              
                           
                         is an antisymmetric matrix formed by the three components of the rotation vector 
                           ϑ
                        , which results in:
                           
                              (53)
                              
                                 
                                    
                                       ϑ
                                    
                                    
                                       ˜
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             −
                                             ψ
                                          
                                          
                                             χ
                                          
                                       
                                       
                                          
                                             ψ
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             φ
                                          
                                       
                                       
                                          
                                             −
                                             χ
                                          
                                          
                                             φ
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 .
                              
                           
                        
                     

If a sequence of n successive rotations 
                           {
                           
                              
                                 
                                    ϑ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    ϑ
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    ϑ
                                 
                                 
                                    n
                                 
                              
                           
                           }
                         is applied on the vector 
                           p
                        , and the corresponding rotation matrices of them are 
                           {
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    R
                                 
                                 
                                    n
                                 
                              
                           
                           }
                        , the final total rotation matrix 
                           R
                         of this sequence of rotations can be written as:
                           
                              (54)
                              
                                 R
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 ⋯
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 .
                              
                           
                        
                     

Eqs. (51)–(54) show some basic properties of the rotation matrix. In this study, 
                           R
                         is the average global rotation matrix for the shell element, and in addition four nodes also possess their own global rotation matrices 
                           
                              
                                 R
                              
                              
                                 a
                              
                           
                        , 
                           a
                           =
                           1
                           ,
                           2
                           ,
                           3
                           ,
                           4
                        . According to (51), the local rotation matrix 
                           
                              
                                 
                                    
                                       R
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         related to the local rotation 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         of node a can be expressed as:
                           
                              (55)
                              
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 exp
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       a
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                 
                              
                           
                        where the anti-symmetric matrix 
                           
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 a
                              
                           
                         is formed by three components in the local rotation vector 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                        , using (53).

The global rotation 
                           
                              
                                 θ
                              
                              
                                 a
                              
                           
                         from the reference to the current configurations may be a finite rotation, while the corresponding local rotation 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         after removing the rigid motion can seem to be infinitesimal small. Thus, the local rotation matrix 
                           
                              
                                 
                                    
                                       R
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         
                        (55) is rewritten in the following form according to (52):
                           
                              (56)
                              
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 exp
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       a
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                 
                                 ≈
                                 I
                                 +
                                 
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 .
                              
                           
                        
                     

Since any matrix can be represented as the summation of a symmetric matrix and an anti-symmetric matrix, the anti-symmetric part of the local rotation matrix 
                           
                              
                                 
                                    
                                       R
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         should be equal to the anti-symmetric matrix 
                           
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 a
                              
                           
                         in (56), which leads to:
                           
                              (57)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                a
                                             
                                          
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       A
                                    
                                 
                              
                           
                        where the operator 
                           
                              
                                 [
                                 
                                    …
                                 
                                 ]
                              
                              
                                 A
                              
                           
                         means picking up the anti-symmetric part of the matrix in the bracket.

The global rotation matrix 
                           
                              
                                 R
                              
                              
                                 a
                              
                           
                         in (57) is related to the global rotation 
                           
                              
                                 θ
                              
                              
                                 a
                              
                           
                         of each node, and is composed of two successive rotations which are the rotation 
                           
                              
                                 θ
                              
                              
                                 a
                              
                              
                                 n
                              
                           
                         between the reference and nominal configurations and the rotation 
                           
                              
                                 ϑ
                              
                              
                                 a
                              
                           
                         between the nominal and current configurations. Since these rotations may be finite rotations, the composition here is not a simple addition and it results in:
                           
                              (58)
                              
                                 
                                    
                                       R
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 exp
                                 (
                                 
                                    
                                       
                                          
                                             
                                                ϑ
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          a
                                       
                                    
                                 
                                 )
                                 
                                 exp
                                 (
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ˜
                                             
                                          
                                       
                                       
                                          a
                                       
                                       
                                          n
                                       
                                    
                                 
                                 )
                              
                           
                        where Eqs. (51) and (54) are used.

Introducing (58) into (57), the anti-symmetric matrix 
                           
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 a
                              
                           
                         formed by the three components of the local rotation vector 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         of node a can be rewritten as:
                           
                              (59)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         ϑ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          )
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          )
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       A
                                    
                                 
                                 .
                              
                           
                        
                     

Then using (53), the local rotation vector 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 a
                              
                           
                         can be obtained by its corresponding anti-symmetric matrix 
                           
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 a
                              
                           
                        , given by:
                           
                              (60)
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         ϑ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          )
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          )
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       A
                                       −
                                       V
                                    
                                 
                              
                           
                        where the operator 
                           
                              
                                 [
                                 
                                    
                                 
                                 ]
                              
                              
                                 A
                                 −
                                 V
                              
                           
                         means picking up the anti-symmetric part of the matrix in the bracket and then generating a vector using the three independent components of this anti-symmetric matrix.


                        Strain energy – shell model: In a co-rotational frame, the element strain energy only depends on local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         which are related to the deformational part of the total motion, given by:
                           
                              (61)
                              
                                 
                                    
                                       U
                                    
                                    
                                       ¯
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 C
                                 
                                    
                                       ε
                                    
                                    
                                       ^
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                        where the vector 
                           
                              
                                 ε
                              
                              
                                 ^
                              
                           
                         is the local strain of the element, 
                           C
                         is the material matrix, and 
                           
                              
                                 K
                              
                              
                                 L
                              
                           
                         is the linear stiffness matrix of a quadrilateral element. From (61), it can be seen that the element strain energy 
                           
                              
                                 U
                              
                              
                                 ¯
                              
                           
                         is a quadratic function of local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                        , hence we can differentiate 
                           
                              
                                 U
                              
                              
                                 ¯
                              
                           
                         up to a second order form, as follows:
                           
                              (62)
                              
                                 
                                    
                                       f
                                    
                                    
                                       ^
                                    
                                 
                                 =
                                 
                                    
                                       ∂
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                        
                        
                           
                              (63)
                              
                                 
                                    
                                       K
                                    
                                    
                                       L
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             U
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   q
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           
                        where the first and second order derivatives of the strain energy are the local internal load 
                           
                              
                                 f
                              
                              
                                 ^
                              
                           
                         and linear stiffness matrix 
                           
                              
                                 K
                              
                              
                                 L
                              
                           
                        , respectively. Substituting (62) and (63) into Eqs. (25)–(28), we obtain the components of the internal load vector 
                           f
                        , tangent stiffness matrix 
                           L
                        , three-dimensional matrix 
                           Q
                         and four-dimensional matrix 
                           C
                         of the equilibrium equations (5) for the shell element, where p, i, j, k, m, n=1,…, 24, and the summation convention is applied on m and n. Similar to the beam element, derivatives of local degrees of freedom 
                           
                              
                                 q
                              
                              
                                 ^
                              
                           
                         with respect to global degrees of freedom 
                           q
                         are needed. Since local degrees of freedom have been split into local translations and local rotations, their derivatives are presented in following two parts.


                        Derivatives of local translations: The first order derivatives of local translations with respect to global degrees of freedom are introduced below, the second to fourth order derivatives can be easily achieved following the same method.

According to the expression of local translations (48), its first order derivatives result in:
                           
                              (64)
                              
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       t
                                    
                                    
                                       a
                                    
                                 
                                 +
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                t
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       0
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       a
                                    
                                    
                                       0
                                    
                                 
                                 
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 24
                              
                           
                        with the unknown quantities, 
                           
                              
                                 ∂
                                 
                                    
                                       t
                                    
                                    
                                       a
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         and 
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        , on the right hand side. Term 
                           
                              
                                 ∂
                                 
                                    
                                       t
                                    
                                    
                                       a
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         is obtained as:
                           
                              (65)
                              
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                t
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      1
                                                      
                                                      0
                                                      
                                                      0
                                                   
                                                   ]
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   t
                                                
                                                
                                                   a
                                                
                                             
                                             (
                                             1
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      0
                                                      
                                                      1
                                                      
                                                      0
                                                   
                                                   ]
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   t
                                                
                                                
                                                   a
                                                
                                             
                                             (
                                             2
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      0
                                                      
                                                      0
                                                      
                                                      1
                                                   
                                                   ]
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             
                                                
                                                   t
                                                
                                                
                                                   a
                                                
                                             
                                             (
                                             3
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   [
                                                   
                                                      0
                                                      
                                                      0
                                                      
                                                      0
                                                   
                                                   ]
                                                
                                                
                                                   t
                                                
                                             
                                             ,
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                             =
                                             others
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                           (
                           i
                           )
                           ,
                           
                           i
                           =
                           1
                           ,
                           2
                           ,
                           3
                         are the three components of global translation 
                           
                              
                                 t
                              
                              
                                 a
                              
                           
                        . The calculation of term 
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         needs some simple forward and back substitutions, which we provide in Appendix B.1.


                        Derivatives of local rotations: Based on (60), the first order derivatives of the local rotations with respect to global degrees of freedom can be achieved as follows:
                           
                              (66)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                             
                                                t
                                             
                                          
                                          (
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            t
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                             exp
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            ϑ
                                                         
                                                         
                                                            ˜
                                                         
                                                      
                                                   
                                                   
                                                      a
                                                   
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   t
                                                
                                             
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                      exp
                                                      (
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ϑ
                                                                  
                                                                  
                                                                     ˜
                                                                  
                                                               
                                                            
                                                            
                                                               a
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                                
                                                   n
                                                
                                             
                                          
                                          )
                                          
                                             
                                                T
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       A
                                       −
                                       V
                                    
                                 
                                 
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 24
                                 .
                              
                           
                        
                     

Further high order derivatives are obtained analogously. We provide the derivatives of the rotation 
                           R
                         in Appendix B.1.

The derivatives of 
                           exp
                           (
                           
                              
                                 
                                    
                                       
                                          ϑ
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                           
                           )
                         are obtained by differentiating (51):
                           
                              (67)
                              
                                 
                                    
                                       
                                          ∂
                                          
                                          exp
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         ϑ
                                                      
                                                      
                                                         ˜
                                                      
                                                   
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          )
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   
                                                      ϑ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          
                                             ϑ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   
                                                      ϑ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             ϑ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   
                                                      ϑ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 +
                                 ⋯
                                 ≈
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   
                                                      ϑ
                                                   
                                                   
                                                      ˜
                                                   
                                                
                                             
                                             
                                                a
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where the rotation 
                           
                              
                                 ϑ
                              
                              
                                 a
                              
                           
                         between the nominal and current configurations approaches zero, since these derivatives are calculated in the nominal configuration. The following Eqs. (68) and (69) are used to build the derivatives:
                           
                              (68)
                              
                                 
                                    
                                       ϑ
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          a
                                       
                                    
                                    
                                    
                                       
                                          χ
                                       
                                       
                                          a
                                       
                                    
                                    
                                    
                                       
                                          ψ
                                       
                                       
                                          a
                                       
                                    
                                 
                                 ]
                                 ⇒
                                 
                                    
                                       
                                          
                                             ϑ
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       a
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   ψ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          
                                             
                                                
                                                   χ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ψ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             
                                                
                                                   φ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   χ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          
                                             
                                                
                                                   φ
                                                
                                                
                                                   a
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 ,
                                 
                                 
                                    
                                       φ
                                    
                                    
                                       a
                                    
                                 
                                 ,
                                 
                                    
                                       χ
                                    
                                    
                                       a
                                    
                                 
                                 ,
                                 
                                    
                                       ψ
                                    
                                    
                                       a
                                    
                                 
                                 ∈
                                 q
                              
                           
                        
                        
                           
                              (69)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   ϑ
                                                
                                                
                                                   ˜
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             φ
                                          
                                          
                                             a
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             1
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 ;
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   ϑ
                                                
                                                
                                                   ˜
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             χ
                                          
                                          
                                             a
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             −
                                             1
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 ;
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             
                                                
                                                   ϑ
                                                
                                                
                                                   ˜
                                                
                                             
                                          
                                          
                                             a
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             ψ
                                          
                                          
                                             a
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             −
                                             1
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             1
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             0
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                                 .
                              
                           
                        
                     

At this point, the derivatives of local degrees of freedom with respect to global degrees of freedom have been obtained by combining both, the translation part of the shell element, Section 4.2, and the rotation part of the shell element, Section 4.2. Introducing these derivatives into (25)–(28), the equilibrium equations (5) of the shell element in a co-rotational frame are achieved. Now, the reduced order model of the CR shell element can be constructed using the 
                           L
                        , 
                           Q
                         and 
                           C
                         in equilibrium equations (5). 
                           Remark 1
                           The expressions of high order derivatives of local degrees of freedom are complicated, as discussed in Section 4.2. Thus, to facilitate the programming and to optimize the code, an automatic differentiation technology [86] is adopted during the implementation of the co-rotational shell element. In Tsukanov׳s paper [86] the data structure and algorithms are developed for the direct application of generalized Leibniz rules to the numerical computation of partial derivatives in forward mode. The proposed data structure provides constant time access to the partial derivatives, which accelerates the automatic differentiation computations. In our work, this automatic differentiation technique, based on generalized Leibniz rules, is used to differentiate a composite function in a forward mode, as given in Appendix B.2.

In the following section we provide several examples that demonstrate the potential of the Koiter–Newton approach using the co-rotational formulation for buckling analysis of geometrically nonlinear structures. We compare our results to classical structural nonlinear analysis results obtained from ABAQUS [87] computations using the full number of equations of the finite element model. The discrete models in our computations correspond the models used for the ABAQUS reference solution, with the same number of nodes and elements. The step size of the proposed approach is indicated in the load-displacement diagrams of the reference solution with markers. It should be pointed out that the path-following method implemented in ABAQUS is a variant of the modified Riks method, also known as Riks/Wempner method, and this method may be not optimal in terms of number of linear systems that need to be solved. Hence, the results are also compared with those obtained in former works using different algorithms [53,56,88–90]
                  

The selected examples are classical benchmark studies of buckling analysis with large deformations, and some of the structures are made of laminated composites. They represent severe test cases due to the highly nonlinear equilibrium path and/or a number of closely spaced buckling modes which are present in the structure.

Two arch structures with a different curvature are fetched from a whole circle, as shown in Fig. 7
                        . These structures are characterized by highly geometric nonlinearities in the prebuckling state [91,92]. In this paper, we discuss the performance of the developed co-rotational beam element using the Koiter–Newton approach. We modeled the shallow arch with 80 beam elements which results in 234 degrees of freedom. The deep arch was modeled with 100 element resulting in 303 degrees of freedom.

For both arch structures, the used reduced order model has two degrees of freedom, where one degree of freedom represents the primary path, and another one indicates the first buckling mode. We show the vertical displacement of the loading point versus the applied load in Fig. 8
                         for the shallow arch. The solid line represents an ABAQUS reference solution, the triangle markers indicate the solution steps of the proposed Koiter–Newton approach and correspondingly represent the accepted equilibrium state. Each of the marked solution steps follows from a nonlinear prediction provided by the reduced order model which is indicated by the red, green and blue curve, respectively. It can be seen that the range of validity of the reduced order model is limited, the prediction is considered accurate up to the triangle marker on the equilibrium path. A few consecutive corrector steps are used to recover full equilibrium and to fully coincide with the reference solution. It is one of the essential properties of the Koiter–Newton approach that the predictor step closely follows the equilibrium path thus allowing for a significantly larger step size compared to classical methods. The range of validity is essentially determined by the projected buckling information into the reduced order model which is adapted according to the complexity of the considered structure and expected solution. As an indicator for a reliable choice of the size of the reduced order model the distribution of the buckling load spectrum is considered. All modes corresponding to closely spaced buckling modes are used to provide a sufficiently enriched reduced order model which represents the desired buckling response.

The practical relevance of the large step-size used in the method becomes obvious in all stability-related problems from engineering, in particular, where a systematic analysis or a probabilistic analysis requires the consideration of a larger number of models for a reliable prediction of the structural response [93,94]. But also standard stability analyses profit significantly from the reduced numerical effort of the approach which still constitutes a limiting factor for many standard methods where the complete numerical model is used and often a large number of load steps is needed to detect reliably the singular points of a complex equilibrium path.

In the remaining example of this paper we will use only markers on the reference solution to represent the step size of each Koiter–Newton step. The nonlinear response curve of the shallow arch model was obtained within 3 load steps which required 9 solutions of the global governing linear system of equations. In comparison, the ABAQUS solution adopts 41 load steps which needed 84 solution steps of the governing linear system of equations, cf. Fig. 8(a). The deep arch needs 5 load steps to solve 15 full FEM systems due to the more severe geometrical nonlinearities, compared to 89 load steps with 182 full FEM systems needed for ABAQUS, as shown in Fig. 8(b). The large deformation of the deep arch near the limit point is shown in Fig. 9
                         and compared with the result from ABAQUS.

The deep arch example has been tested in many studies using different algorithms [88–90,53]. Simo [90] needed 155 steps using the Newton–Raphson method, and Kouhia [88] used different strategies with at least 34 steps and 220 iterations. Lahmam [53] proposed a high-order predictor-corrector algorithm based on the asymptotic numerical method which needs 8 load steps.

In the following example we apply our method to a frame which is composed of 7 beams, see Fig. 10
                        (a). A similar classical benchmark, a 3D 12 member frame, has been presented and discussed in [92,95] using analytical methods or the Newton–Raphson method and its variants. Six elements per beam member are used in the current Koiter–Newton analysis which results in 249 degrees of freedom. A reduced order model with 2 degrees of freedom is constructed, where one represents the primary path, and another one indicates the first buckling mode. From the response curve about the lateral displacement of the loading point vs. the applied load in Fig. 10(b), it can be observed that the present analysis is in a good agreement with the result from ABAQUS, however, only four steps are needed in the Koiter–Newton analysis to achieve the response curve, compared to 74 steps needed by ABAQUS.

A hinged semi-cylindrical roof subjected to a central pinching force, see Fig. 11
                        (a), is a popular benchmark problem for geometric nonlinear analysis of shells due to the snap-through behavior of the structural response, and this benchmark has received considerable attention particular with respect to the Newton arc-length methods [96,97]. An isotropic material and two different laminates are considered in this example, with the properties listed in Table 1
                        , 100 co-rotational shell elements were used to mesh the structure. The first buckling load is 
                           
                              
                                 F
                              
                              
                                 pcr
                              
                           
                           =
                           4.56
                           
                           KN
                         for the isotropic case, and 
                           
                              
                                 F
                              
                              
                                 pcr
                              
                           
                           =
                           3.58
                           
                           KN
                         and 
                           
                              
                                 F
                              
                              
                                 pcr
                              
                           
                           =
                           2.22
                           
                           KN
                         for [0/90/0] and [90/0/90] laminations, respectively. Since the first buckling loads are well separated from the others, reduced order models with 2 degrees of freedom are constructed in the Koiter–Newton approach. The nonlinear response curves, about the lateral displacement of the loading point versus the applied load, are reported in Fig. 11(b) for the isotropic material model and the two laminated composite structures, and compared with corresponding ABAQUS analysis results. Three steps with the solutions of 9 full FEM systems are used for all three material cases, compared to 44 steps solving 89 linear FEM systems needed for ABAQUS.

This example is a classical benchmark and has been tested in many researches [56,53,88]. The Newton Raphson method or variants of this method need to solve 40–70 FEM systems whereas other methods such as asymptotic numerical methods [98] only need to solve less than 10 full systems of equations [53].

A C-shaped beam is a commonly used structure in aerospace and marine engineering. As discussed in [12], a cantilever C-shaped beam provides a severe buckling test due to its folding plate, interaction modes and serious nonlinear prebuckling behavior [99,100]. The parameters of the C-shaped beam are shown in Fig. 12
                        (a). We consider both, isotropic material properties and a laminate composite structure, with the properties given in Table 2
                        . The beam is meshed with 1440 co-rotational shell elements. The reduced order model is constructed with 5 degrees of freedom, five of which are related to the first four closely spaced buckling modes, shown in Fig. 13
                        . The first order displacement fields, 
                           
                              
                                 u
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 u
                              
                              
                                 2
                              
                           
                        , are shown in Fig. 14
                        . The nonlinear response curves, about the lateral displacement of loading point vs. load, for isotropic material and laminated composite are plotted in Fig. 12(b) and compared with the ABAQUS analysis. Five and six steps are used, respectively, for the two material cases, compared to the 105 steps needed for the ABAQUS analysis.

@&#CONCLUSIONS@&#

The Koiter–Newton approach is a hybrid reduced order modeling technique inspired by Koiter׳s classical initial post-buckling theory and a Newton arc-length method for the buckling analysis of geometrically nonlinear structures. The proposed approach can be used to trace the entire nonlinear equilibrium path of a structure in a stepwise manner and demonstrates high effectiveness and stability in the presence of buckling.

In this paper, we lay stress on the finite element formulation of beam and shell elements and implementation aspects of the Koiter–Newton approach using a co-rotational formulation. We extended the element formulations by a co-rotational formulation which facilitates the computation of the up to the fourth order derivatives of the strain energy with respect to the degrees of freedom which are needed to construct the reduced order model. Since in this formulation the geometrical nonlinearities are taken into account using derivatives of the local co-rotational frame with respect to the global degrees of freedom which are independent of the element type, we are able to apply our formulation reliably to any type of linear finite elements from the current element library. Besides a 2D beam element we provided a 3D shell element formulation which is the more challenging case due to large rotations in 3D. We first introduced three configurations to describe the deformation of the shell element, which serves the description of the large rotations. We then adopted the nonlinear rotation matrix to describe accurately the finite rotations of the shell. Finally, we used an automated differentiation technique which significantly simplifies the programming of the needed high order derivatives.

Using several benchmark problems for beam and shell models we assessed the accuracy of our method and demonstrated high computational efficiency compared to established state-of-the-art finite element software packages. The high level of accuracy of the Koiter–Newton method using a co-rotational formulation is also ensured for geometrically highly nonlinear cases accompanied by buckling phenomena as demonstrated for isotropic and laminate composite shell models. Finally we showed the high efficiency of the method with regard to computational cost for tracing the complete nonlinear equilibrium response path of a structure. Compared to the computational cost of ABAQUS analysis of full dimension the proposed method reduces the effort by more than a factor 15 in almost all cases, independent of the geometric dimension. We believe that the proposed Koiter–Newton method is a successful representative of the class of reduced order models with a distinct potential to soften computational limitations during the design process of structures with a geometrically highly nonlinear response.

@&#ACKNOWLEDGMENT@&#

The research leading to these results received funding from the European Community׳s Seventh Framework Programme ([FP7/2007-2013]) under grant agreement no. 282522. This research work was also sponsored by Laboratory Independent Innovation project of Qian Xuesen Laboratory of Space Technology. Thank you Miranda Aldham-Breary for reviewing the English text carefully.

Second order derivatives of the current length l
                     
                        n
                      of the beam element and the rigid rotation θ with respect to the global degrees of freedom:
                        
                           (A.1)
                           
                              {
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          −
                                          (
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            n
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∂
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            l
                                                         
                                                         
                                                            n
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∂
                                                      θ
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

Third order derivatives:
                        
                           (A.2)
                           
                              {
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         p
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         p
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         p
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          =
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                l
                                             
                                             
                                                n
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   θ
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

Fourth order derivatives:
                        
                           (A.3)
                           
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          4
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                           
                        
                      
                     
                        
                           (A.4)
                           
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          4
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              =
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              −
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          3
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    ∂
                                    
                                       
                                          l
                                       
                                       
                                          n
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              +
                              
                                 
                                    l
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    
                                       
                                          ∂
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                    
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 
                                    ∂
                                    θ
                                 
                                 
                                    ∂
                                    
                                       
                                          p
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              .
                           
                        
                     
                  

The component of the first derivative of the rotation matrix 
                           R
                         with respect to the global degrees of freedom 
                           q
                        , that is the 
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        , is calculated as follows.

First, we differentiate both sides of (43) with respect to global degrees of freedom, and then multiply the transpose of the rotation matrix 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                         on both sides, which results in:
                           
                              (B.1)
                              
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          F
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          R
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 U
                                 +
                                 
                                    
                                       ∂
                                       U
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        where the fact of 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           R
                           =
                           I
                         is used, since the rotation matrix 
                           R
                         is an orthogonal matrix.

Any matrix can be represented as a summation of a symmetric matrix and an anti-symmetric matrix. The derivatives of the symmetric matrix 
                           U
                         is still a symmetric matrix, which indicates that the anti-symmetric part of (B.1) is given by:
                           
                              (B.2)
                              
                                 
                                    
                                       [
                                       
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                ∂
                                                R
                                             
                                             
                                                ∂
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                          U
                                       
                                       ]
                                    
                                    
                                       A
                                    
                                 
                                 =
                                 
                                    
                                       [
                                       
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   F
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       A
                                    
                                 
                              
                           
                        where the operator 
                           
                              
                                 [
                                 
                                    
                                 
                                 ]
                              
                              
                                 A
                              
                           
                         is used to pick up the anti-symmetric part of the matrix in the bracket.

we use 
                           P
                         to indicate matrix 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           
                              
                                 ∂
                                 F
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         in the right hand side of (B.2), that is:
                           
                              (B.3)
                              
                                 P
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ∂
                                       F
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        where term 
                           
                              
                                 ∂
                                 F
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         is achieved by differentiating (42), as given by:
                           
                              (B.4)
                              
                                 
                                    
                                       
                                          ∂
                                          F
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            d
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            d
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            d
                                                         
                                                         
                                                            3
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 
                                    
                                       [
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                             
                                                0
                                             
                                          
                                          
                                          
                                             
                                                d
                                             
                                             
                                                3
                                             
                                             
                                                0
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       −
                                       1
                                    
                                 
                              
                           
                        where term 
                           [
                           
                              
                                 
                                    ∂
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                              
                                 
                                    ∂
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                              
                                 
                                    ∂
                                    
                                       
                                          d
                                       
                                       
                                          3
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          q
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                           
                           ]
                         can be easily obtained by geometry and deformation relations.

The matrix 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           
                              
                                 ∂
                                 R
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         in the left hand side of (B.2) is an anti-symmetric matrix, and this conclusion is obtained by differentiating the equation 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           R
                           =
                           I
                         on both sides, which is given as:
                           
                              (B.5)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             R
                                          
                                          
                                             t
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 R
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ∂
                                       R
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 0
                                 ⇒
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       
                                          ∂
                                          R
                                       
                                       
                                          ∂
                                          
                                             
                                                q
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 =
                                 −
                                 
                                    
                                       (
                                       
                                          
                                             
                                                R
                                             
                                             
                                                t
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   R
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       t
                                    
                                 
                                 .
                              
                           
                        
                     

Hence, The matrix 
                           
                              
                                 R
                              
                              
                                 t
                              
                           
                           
                              
                                 ∂
                                 R
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                         can be represented by a anti-symmetric matrix 
                           
                              
                                 S
                              
                              
                                 j
                              
                           
                        , as:
                           
                              (B.6)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                                 
                                    
                                       ∂
                                       R
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   1
                                                   j
                                                
                                             
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   2
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   s
                                                
                                                
                                                   1
                                                   j
                                                
                                             
                                          
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   3
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   s
                                                
                                                
                                                   2
                                                   j
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   s
                                                
                                                
                                                   3
                                                   j
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ]
                              
                           
                        where s
                        1j
                        , s
                        2j
                         and s
                        3j
                         are the three independent components in this anti-symmetric matrix 
                           
                              
                                 S
                              
                              
                                 j
                              
                           
                        .

Any anti-symmetric matrix can be expressed by the three independent components, hence the independent components of the two anti-symmetric matrices in (B.2) should be equal, which leads to a linear system of equations:
                           
                              (B.7)
                              
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   11
                                                
                                             
                                             +
                                             
                                                
                                                   U
                                                
                                                
                                                   22
                                                
                                             
                                          
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   23
                                                
                                             
                                          
                                          
                                             −
                                             
                                                
                                                   U
                                                
                                                
                                                   13
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   23
                                                
                                             
                                          
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   11
                                                
                                             
                                             +
                                             
                                                
                                                   U
                                                
                                                
                                                   33
                                                
                                             
                                          
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   12
                                                
                                             
                                          
                                       
                                       
                                          
                                             −
                                             
                                                
                                                   U
                                                
                                                
                                                   13
                                                
                                             
                                          
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   12
                                                
                                             
                                          
                                          
                                             
                                                
                                                   U
                                                
                                                
                                                   22
                                                
                                             
                                             +
                                             
                                                
                                                   U
                                                
                                                
                                                   33
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   1
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   2
                                                   j
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   3
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                                 =
                                 [
                                 
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   12
                                                
                                             
                                             −
                                             
                                                
                                                   P
                                                
                                                
                                                   21
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   13
                                                
                                             
                                             −
                                             
                                                
                                                   P
                                                
                                                
                                                   31
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   23
                                                
                                             
                                             −
                                             
                                                
                                                   P
                                                
                                                
                                                   32
                                                
                                             
                                          
                                       
                                    
                                 
                                 ]
                              
                           
                        where U
                        11, U
                        22, U
                        33, U
                        12, U
                        13 and U
                        23 are components of symmetric matrix 
                           U
                        , and P
                        12, P
                        21, P
                        13, P
                        31, P
                        23 and P
                        32 are components of matrix 
                           P
                         defined in (B.3).

After solving this linear system of equations (B.7) and introducing the solution vector 
                           [
                           
                              
                                 
                                    s
                                 
                                 
                                    1
                                    j
                                 
                              
                              
                              
                                 
                                    s
                                 
                                 
                                    2
                                    j
                                 
                              
                              
                              
                                 
                                    s
                                 
                                 
                                    3
                                    j
                                 
                              
                           
                           ]
                         into (B.6), we can obtain the anti-symmetric matrix 
                           
                              
                                 S
                              
                              
                                 j
                              
                           
                        . Then, according to (B.6), the component of the first derivative of the rotation matrix with respect to global degrees of freedom, 
                           
                              
                                 ∂
                                 
                                    
                                       R
                                    
                                    
                                       t
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        , is achieved by:
                           
                              (B.8)
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             R
                                          
                                          
                                             t
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             q
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       RS
                                    
                                    
                                       j
                                    
                                 
                                 .
                              
                           
                        
                     

In our work, local translations (48) and local rotations (60) both are products of two variable functions, which can be simply represented by 
                           y
                           (
                           x
                           )
                           =
                           p
                           (
                           x
                           )
                           q
                           (
                           x
                           )
                        . In Tsukanov׳s work, a partial derivative of a product of two functions is a linear combination of products of partial derivatives of p and q with binomial coefficients, which gives [86]:
                           
                              (B.9)
                              
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             |
                                             
                                                δ
                                             
                                             |
                                          
                                       
                                       y
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       ⋯
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             n
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       0
                                    
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       0
                                    
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ⋯
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             n
                                          
                                       
                                       =
                                       0
                                    
                                    
                                       
                                          
                                             δ
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 ⋯
                                 (
                                 
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                 
                                 )
                                 ⁎
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             |
                                             
                                                α
                                             
                                             |
                                          
                                       
                                       p
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       ⋯
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             n
                                          
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                 
                                 ⁎
                                 
                                    
                                       
                                          
                                             ∂
                                          
                                          
                                             |
                                             
                                                δ
                                                −
                                                α
                                             
                                             |
                                          
                                       
                                       q
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   1
                                                
                                             
                                             −
                                             
                                                
                                                   α
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             2
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   2
                                                
                                             
                                             −
                                             
                                                
                                                   α
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       ⋯
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             n
                                          
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   n
                                                
                                             
                                             −
                                             
                                                
                                                   α
                                                
                                                
                                                   n
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              (B.10)
                              
                                 |
                                 
                                    δ
                                 
                                 |
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       δ
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                 0
                                 <
                                 |
                                 
                                    δ
                                 
                                 |
                                 ≤
                                 m
                              
                           
                        
                        
                           
                              (B.11)
                              
                                 |
                                 
                                    α
                                 
                                 |
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        where m is the order of the highest derivative, α is a multi-index the elements of which serve as counters of summation loops, 
                           (
                           
                              
                                 
                                    
                                       
                                          δ
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           
                           )
                           ,
                           
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                         are binomial coefficients. In this way, higher order derivatives can be achieved using the known lower order derivatives efficiently in a forward mode.

@&#REFERENCES@&#

